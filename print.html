<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Goat</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="introduction/glossary.html"><strong aria-hidden="true">1.1.</strong> Glossary</a></li></ol></li><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="command-line-tool/index.html"><strong aria-hidden="true">3.</strong> Command Line Tool</a></li><li class="chapter-item expanded "><a href="explanations/index.html"><strong aria-hidden="true">4.</strong> How does it work?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="explanations/state.html"><strong aria-hidden="true">4.1.</strong> State Management</a></li><li class="chapter-item expanded "><a href="explanations/lifecycle.html"><strong aria-hidden="true">4.2.</strong> Lifecycle</a></li></ol></li><li class="chapter-item expanded "><a href="goatfile/index.html"><strong aria-hidden="true">5.</strong> Goatfile</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="goatfile/specification.html"><strong aria-hidden="true">5.1.</strong> Syntax Specification</a></li><li class="chapter-item expanded "><a href="goatfile/import-statement.html"><strong aria-hidden="true">5.2.</strong> Import Statement</a></li><li class="chapter-item expanded "><a href="goatfile/execute-statement.html"><strong aria-hidden="true">5.3.</strong> Execute Statement</a></li><li class="chapter-item expanded "><a href="goatfile/sections.html"><strong aria-hidden="true">5.4.</strong> Sections</a></li><li class="chapter-item expanded "><a href="goatfile/defaults-section.html"><strong aria-hidden="true">5.5.</strong> Defaults Section</a></li><li class="chapter-item expanded "><a href="goatfile/logsections.html"><strong aria-hidden="true">5.6.</strong> Log Sections</a></li><li class="chapter-item expanded "><a href="goatfile/requests/index.html"><strong aria-hidden="true">5.7.</strong> Requests</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="goatfile/requests/method-and-url.html"><strong aria-hidden="true">5.7.1.</strong> Method and URL</a></li><li class="chapter-item expanded "><a href="goatfile/requests/options.html"><strong aria-hidden="true">5.7.2.</strong> Options</a></li><li class="chapter-item expanded "><a href="goatfile/requests/header.html"><strong aria-hidden="true">5.7.3.</strong> Headers</a></li><li class="chapter-item expanded "><a href="goatfile/requests/query-params.html"><strong aria-hidden="true">5.7.4.</strong> Query Parameters</a></li><li class="chapter-item expanded "><a href="goatfile/requests/body.html"><strong aria-hidden="true">5.7.5.</strong> Body</a></li><li class="chapter-item expanded "><a href="goatfile/requests/prescript.html"><strong aria-hidden="true">5.7.6.</strong> PreScript</a></li><li class="chapter-item expanded "><a href="goatfile/requests/script.html"><strong aria-hidden="true">5.7.7.</strong> Script</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="templating/index.html"><strong aria-hidden="true">6.</strong> Templating</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="templating/builtins.html"><strong aria-hidden="true">6.1.</strong> Builtins</a></li></ol></li><li class="chapter-item expanded "><a href="scripting/index.html"><strong aria-hidden="true">7.</strong> Scripting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="scripting/builtins.html"><strong aria-hidden="true">7.1.</strong> Builtins</a></li></ol></li><li class="chapter-item expanded "><a href="project-structure/index.html"><strong aria-hidden="true">8.</strong> Project Structure</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Goat</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="introduction"><a class="header" href="#introduction">Introduction</a></h1>
<p>Hey and welcome to the Goat documentation!</p>
<p>Here you will learn how to use the Goat CLI tool and how to write Goatfiles.</p>
<p>For better understanding and conciseness, we highly suggest to take a look at the <a href="introduction/./glossary.html">Glossary</a> before continuing into the documentation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<p>To make this documentation more concise and understandable, here you can find a list of all special terms and their definitions used across the documentation.</p>
<ul>
<li><code>Goatfile</code> - A file with the extension <code>.goat</code> which is interpreted and executed by the Goat CLI.</li>
<li><code>action</code> - Can be any executable entity defined in a Goatfile like a request, log entry or execution.</li>
<li><code>batch</code> - Defines the execution of multiple requests and actions across one or multiple Goatfiles. </li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<h3 id="pre-built-binaries"><a class="header" href="#pre-built-binaries">Pre-Built Binaries</a></h3>
<p>First of all, you need to install the <code>goat</code> tool. It is distributed as a single binary without any dependencies. So simply download the <a href="https://github.com/studio-b12/goat/releases"><strong>latest release binaries from GitHub</strong></a> fitting your system configuration.</p>
<p>You can also use the provided <a href="https://github.com/studio-b12/goat/blob/main/scripts/download.sh">installation script</a>, if you want.</p>
<pre><code class="language-bash">$ curl -Ls https://raw.githubusercontent.com/studio-b12/goat/main/scripts/download.sh | bash -
</code></pre>
<h3 id="installation-with-go-install"><a class="header" href="#installation-with-go-install">Installation with <code>go install</code></a></h3>
<p>Alternatively, if you have the Go toolchain installed on your system, you can also simply use <code>go install</code> to build and install the tool for your system. This is also very useful if no pre-built binary is available for your specific system configuration.</p>
<blockquote>
<p>Details on how to install the Go toolchain is available <a href="https://go.dev/doc/install">here</a>.</p>
</blockquote>
<p>Now, simply use the following command to install the program.</p>
<pre><code>go install github.com/studio-b12/goat/cmd/goat@latest
</code></pre>
<p>This will install the latest tagged version. You can also specify a specific version or branch after the <code>@</code>.</p>
<pre><code>go install github.com/studio-b12/goat/cmd/goat@dev
</code></pre>
<h2 id="first-goatfile"><a class="header" href="#first-goatfile">First Goatfile</a></h2>
<p>After that, simply use the following command to initalize a new Goatfile.</p>
<pre><code>goat --new
</code></pre>
<p>This will generate a new Goatfile with the name <code>tests.goat</code> at your current working directory with some simple examples and documentation. You can use this file as your starting point to play around with Goat or to create your projects integration test structure.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-tool"><a class="header" href="#command-line-tool">Command Line Tool</a></h1>
<p>The <code>goat</code> command is used to create, validate and execute Goatfiles.</p>
<p>You can pass one or multiple Goatfiles or directories as positional argument. For example:</p>
<pre><code>goat issue_32.goat tests/integrationtests
</code></pre>
<p>When passing in a directory, Goat will look for any <code>*.goat</code> file recursively. Files and directories prefixed with an underscore (<code>_</code>) are ignored. This is especially useful for Goatfiles which are only supposed to be imported or executed in other Goatfiles. If you want to read more about this, take a look into the <a href="command-line-tool/../project-structure.html">Project Structure section</a>. </p>
<h2 id="flags"><a class="header" href="#flags">Flags</a></h2>
<p>The following sections provide further information about the various flags which can be passed to <code>goat</code>.</p>
<ul>
<li>
<p><strong><code>-a ARGS</code>, <code>--args ARGS</code></strong><br />
Pass params as key value arguments into the execution. If you want to pass multiple args, specify each pair with its own parameter.<br />
<em>Example: <code>-a hello=world -a user.name=foo -a &quot;user.password=bar bazz&quot;</code></em></p>
</li>
<li>
<p><strong><code>--delay DELAY</code>, <code> -d DELAY</code></strong><br />
Delay all requests by the given duration. The duration is formatted according to the format of Go's <a href="https://pkg.go.dev/time#ParseDuration"><code>time.ParseDuration</code></a> function.<br />
<em>Example: <code>-d 1s30ms</code></em></p>
</li>
<li>
<p><strong><code>--dry</code></strong><br />
Only parse the goatfile(s) without executing any requests.</p>
</li>
<li>
<p><strong><code>--gradual</code>, <code> -g</code></strong><br />
Advance the requests maually.</p>
</li>
<li>
<p><strong><code>--json</code></strong><br />
Use JSON format instead of pretty console format for logging.</p>
</li>
<li>
<p><strong><code>--loglevel LOGLEVEL</code>, <code> -l LOGLEVEL</code></strong><br />
Logging level. <a href="https://github.com/zekroTJA/rogu#levels">Here</a> you can see which values you can use for log levels.<br />
<em>Example: <code>-l trace</code></em></p>
</li>
<li>
<p><strong><code>--new</code></strong><br />
Create a new base Goatfile.</p>
</li>
<li>
<p><strong><code>--no-abort</code></strong><br />
Do not abort the batch execution on error.</p>
</li>
<li>
<p><strong><code>--no-color</code></strong><br />
Supress colored log output.</p>
</li>
<li>
<p><strong><code>--params PARAMS</code>, <code> -p PARAMS</code></strong><br />
Pass parameters in parameter files. These can be either TOML, YAML or JSON files. If you want to pass multiple parameter files, specify each one with its own parameter.<br />
<em>Example: <code>-p ./local.toml -p ~/credentials.yaml</code></em></p>
</li>
<li>
<p><strong><code>--silent</code>, <code> -s</code></strong><br />
Disables all logging output. Only <code>print</code> and <code>println</code> statements will be printed. This is especially useful if you want to use Goatfiles inwith other scripts.</p>
</li>
<li>
<p><strong><code>--skip SKIP</code></strong><br />
Section(s) to be skipped during execution.<br />
<em>Example: <code>--skip teardown</code></em></p>
</li>
<li>
<p><strong><code>--help</code>, <code> -h</code></strong><br />
Display the help message.</p>
</li>
<li>
<p><strong><code>--version</code></strong><br />
Display the installed version.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-does-it-work"><a class="header" href="#how-does-it-work">How does it work?</a></h1>
<p>In the following sections you will learn more how the internals of Goat work to better understand how to work with and create Goatfiles fitting your testing situation.</p>
<ul>
<li><a href="explanations/./state.html">State Management</a></li>
<li><a href="explanations/./lifecycle.html">Lifecycle</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="state-management"><a class="header" href="#state-management">State Management</a></h1>
<p>Goat initializes a state for every Goatfile execution. A state initially consists of the passed parameters which were either passed via a configuration file, via environment variables or via the <code>--args</code> CLI parameter.</p>
<p>This state is then passed to every request in the executed Goatfile. The request can read and alter the state.
When one request has finished, the state is passed into the next request, and so on until the execution has finished.</p>
<p>Below, you can see a very simple example of how a state lifecycle could look like.</p>
<p><img src="explanations/../assets/simple-state.excalidraw.svg" alt="" /></p>
<h2 id="state-with-use"><a class="header" href="#state-with-use">State with <a href="explanations/../goatfile/import-statement.html"><code>use</code></a></a></h2>
<p>Because <a href="explanations/../goatfile/import-statement.html"><code>use</code></a> effectively merges the imported Goatfile together with the root Goatfile to a single batch execution, state is shared between them. So if you define a variable in a Goatfile imported via <a href="explanations/../goatfile/import-statement.html"><code>use</code></a>, the variable will be accessible in subsequent imported Goatfiles as well as in the root Goatfile.</p>
<h2 id="state-with-execute"><a class="header" href="#state-with-execute">State with <a href="explanations/../goatfile/execute-statement.html"><code>execute</code></a></a></h2>
<p>Executed Goatfiles in another Goatfile via the <a href="explanations/../goatfile/execute-statement.html"><code>execute</code></a> command will handle the executed Goatfile like a separate batch and thus it will create and use a separate state. </p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lifecycle"><a class="header" href="#lifecycle">Lifecycle</a></h1>
<p>In this document, you will learn the basics on how excatly batches and requests are executed and when which section of a batch or test is evaluated.</p>
<h2 id="batch-lifecycle"><a class="header" href="#batch-lifecycle">Batch Lifecycle</a></h2>
<p>Below, you can find a simplified scematic of how a single test batch is executed.</p>
<pre><code class="language-mermaid">%%{init: {'theme':'dark'}}%%
flowchart TD
  collect_args[Collect Params\nand Arguments]
  entry[Parse Entry Goatfile]
  resolve_imports[Resolve Imports]
  parse_imports[Parse Imports]
  merge_files[Merge Files]
  create_state[Create State]
  setup_actions[Execute Setup Actions]
  setup_failed{Failed?}
  teardown_actions[Execute Teardown Actions]
  test_actions[Execute Test Actions]
  test_failed{Failed?}

  entry
    --&gt; resolve_imports
    --&gt; parse_imports -.-&gt; entry
  
  parse_imports
    --&gt; merge_files
    --&gt; setup_actions

  collect_args 
    ----&gt; create_state
    --&gt; setup_actions
    --&gt; setup_failed -- yes --&gt; teardown_actions
        setup_failed -- no --&gt; test_actions
          --&gt; test_failed -- yes --&gt; teardown_actions
              test_failed -- no --&gt; teardown_actions
</code></pre>
<p>Every batch begins with a single entrypoint Goatfile <em>(if you execute Goat on a folder of Goatfiles, each Goatfile in that folder will be seen as entrypoint Goatfile and the batch execution is executed indiviually for each file)</em>. </p>
<p>First, all imported <em>(see <a href="explanations/../goatfile/import-statement.html"><code>use</code></a>)</em> Goatfiles are resolved, parsed and merged together with the entrypoint Goatfile to one single batch execution. So all <code>Default</code>, <code>Setup</code>, <code>Test</code> and <code>Teardown</code> entries are merged together for each file.</p>
<p>&quot;Simultaneously&quot;, all parameters are collected from passed parameter files, environment variables and arguments <em>(see <a href="explanations/../command-line-tool/index.html#flags">Command Line Tool</a>)</em>. These form the initial state.</p>
<p>After that, all <code>Setup</code> actions are executed. If any setup action has failed, the rest of the setup and the entire <code>Test</code> section is skipped. Finally, all teardown steps are executed and the batch exits in a failed state summarizing all errors occured.</p>
<p>If the <code>Setup</code> has completed successfully, the <code>Test</code> section is executed. Same as in the <code>Setup</code> section, when any of the <code>Test</code> actions fails, the entire section is skipped, the teardown actions are executed and the batch exits in a failed state.</p>
<p>If the <code>Test</code> section has completed successfully, the <code>Teardown</code> section is executed. Here, when any action fails, the execution <strong>continues</strong> instead of skipping the rest of the actions to ensure a complete cleanup as intended. If any of the <code>Teardown</code> actions fail, the batch execution will result with a failed state as well.</p>
<h2 id="action-lifecycle"><a class="header" href="#action-lifecycle">Action Lifecycle</a></h2>
<p>Below, you can see a simplified lifecycle diagram of the three actions <code>Request</code>, <code>Execute</code> and <code>Log Section</code>.</p>
<pre><code class="language-mermaid">%%{init: {'theme':'dark'}}%%
flowchart TD
  type{Type of Action}

  exit_with_failure(End with Failure)
  exit_with_success(End with Success)

  %% --- Request Type -----------------------------------------------

  apply_defaults[Apply Defaults]
  pre_substitute[Substitute Parameters\nfrom State]
  run_prescript[Run PreScript]
  prescript_success{Successful?}
  substitute[Re-Substitute Parameters\nfrom State]
  apply_options[Apply Request Options]
  condition_option{Condition Option\nmatches?}
  run_request[Run Request]
  run_script[Run Script]
  script_success{Successful?}

  type 
    -- Request --&gt; apply_defaults
    --&gt; pre_substitute
    --&gt; run_prescript
    --&gt; prescript_success -- no --&gt; exit_with_failure
  
  prescript_success 
    -- yes --&gt; substitute
    --&gt; apply_options
  
  condition_option
    -- yes --&gt; run_request
    --&gt; run_script
    --&gt; script_success -- no --&gt; exit_with_failure

  script_success -- yes --&gt; exit_with_success

  apply_options --&gt; condition_option -- no --&gt; exit_with_success

  %% --- Execute Type -----------------------------------------------

  create_state_from_params[Create State from\npassed Parameters]
  parse_goatfile[Parse Goatfile]
  execute_goatfile[Execute Goatfile]
  execute_success{Successful?}
  apply_captured[Apply captured\nReturn Values]

  type
    -- Execute --&gt; create_state_from_params
    --&gt; parse_goatfile
    --&gt; execute_goatfile
    --&gt; execute_success -- no --&gt; exit_with_failure

  execute_success
    -- yes --&gt; apply_captured
    -------&gt; exit_with_success
    
  %% --- Log Section Type -----------------------------------------------

  print_logsection[Print Section to Log]

  type
    -- Log Section --&gt; print_logsection 
    -----------&gt; exit_with_success
</code></pre>
<h3 id="request"><a class="header" href="#request">Request</a></h3>
<p>A <code>Request</code> action begins with the application of all default parameters from the <code>Default</code> section of the batch. After that, the parameters from the current state are substituted to the templates in the request definition. With that state, the <code>PreScript</code> section is executed. If the execution failed, the request ends with a failure state. Otherwise, the new state is extracted and all templates are re-substituted using the new state. Following, the request options are evaluated and applied. If the option <code>condition</code> is <code>false</code>, the request is skipped which ends the request in a success state. Otherwise, the actual request is now executed. Now, the <code>Script</code> section is executed using the current state. Depending on the result, the request will end with a failure or success state.</p>
<h3 id="execute"><a class="header" href="#execute">Execute</a></h3>
<p>An <code>Execute</code> action &quot;calls&quot; another Goatfile with specified parameters and capture values. The defined parameters are packed into a new state. After that, the referenced Goatfile is parsed and executed with the new state. This execution is a whole new <a href="explanations/lifecycle.html#batch-lifecycle">Batch</a> execution in itself.</p>
<p>If this batch execution has failed, the action results in a failed state as well. If it was successful, the defined values to be captured in the <code>return</code> statement are merged with the current state of the executing batch.</p>
<h3 id="log-section"><a class="header" href="#log-section">Log Section</a></h3>
<p>A <code>Log Section</code> is simply an action that prints a visual separator as <code>INFO</code> entry into the log to visually separate between test sections. This should never result in a failed action state.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="goatfile"><a class="header" href="#goatfile">Goatfile</a></h1>
<p>A Goatfile contains the request definitions for a Goat test suite. Goatfiles are written in plain 
UTF-8 encoded text using the Goatfile syntax.</p>
<p>Goatfiles have the file extension <code>.goat</code>.</p>
<p>Below, you can see a really simple example Goatfile.</p>
<pre><code>### Tests

GET https://api.github.com/repos/{{.repo}}

[Script]
assert(response.StatusCode === 200, `Invalid response code: ${response.StatusCode}`);
assert(response.BodyJson.language === &quot;Go&quot;);

---

GET https://api.github.com/repos/{{.repo}}/languages

[Script]
info('Languages:\n' + JSON.stringify(response.BodyJson, null, 2));
assert(response.StatusCode === 200, `Invalid response code: ${response.StatusCode}`);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="syntax-specification"><a class="header" href="#syntax-specification">Syntax Specification</a></h1>
<p>Goatfiles are built from the following blocks.</p>
<ul>
<li><a href="goatfile/./import-statement.html">Import Statement</a></li>
<li><a href="goatfile/./sections.html">Sections</a></li>
<li><a href="goatfile/./defaults-section.html">Defaults Section</a></li>
<li><a href="goatfile/./logsections.html">Log Sections</a></li>
<li><a href="goatfile/./requests/index.html">Requests</a>
<ul>
<li><a href="goatfile/./requests/header.html">Method and URL</a></li>
<li><a href="goatfile/./requests/options.html">Options</a></li>
<li><a href="goatfile/">Headers</a></li>
<li><a href="goatfile/">Query Parameters</a></li>
<li><a href="goatfile/">Body</a></li>
<li><a href="goatfile/">PreScript</a></li>
<li><a href="goatfile/">Script</a></li>
</ul>
</li>
<li><a href="goatfile/">Execute Statement</a></li>
</ul>
<p>Below, you can see a simple synopsis of the different building blocks of a Goatfile.</p>
<pre><code>         Import  |  use ./setup.goat
                 |
        Comment  |  // This is a comment!
                 |
Section Heading  |  ### Setup
                 |
Context Section  |  ##### Upload Tests
                 |
   Method &amp; URL  |  POST https://example.com
                 |  
        Headers  |  [Header]
                 |  X-Requested-With: XMLHttpRequest
                 |  Content-Type: application/json
                 |  Hash: {{ sha256 .data }}
                 |
           Body  |  [Body]
                 |  ```
                 |  {
                 |    &quot;hello&quot;: &quot;world&quot;,
                 |    &quot;hash&quot;: &quot;{{ sha256 .data }}&quot;,
                 |    &quot;dontescapethis&quot;: &quot;\{\{ \}\}&quot;
                 |  }
                 |  ```
                 |
  Option Blocks  |  [QueryParams]
                 |  page = 2
                 |  items = 30
                 |  filters = [&quot;time&quot;, &quot;name&quot;]
                 |
                 |  [MultipartFormdata]
                 |  image = @myimage.jpeg
                 |
                 |  [Options]
                 |  cookiejar = &quot;foo&quot;
                 |  storecookies = false
                 |
         Script  |  [Script]
                 |  assert(response.status &gt;= 200 &amp;&amp; response.status &lt; 400);
                 |  assert(response.body[&quot;name&quot;] == &quot;somename&quot;);
                 |
                 |  // capture a variable to be used in subsequent responses
                 |  var id = response.body[&quot;id&quot;];
                 |
        Request  |  ---
      Separator  |
                 |
        Execute  |  execute ./testFileUpload (
                 |    file=&quot;file_a.txt&quot;
                 |    token=&quot;{{.auth.token}}&quot;
                 |  ) return (
                 |    fileId as fileId_a
                 |  )
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-statement"><a class="header" href="#import-statement">Import Statement</a></h1>
<h3 id="syntax"><a class="header" href="#syntax">Syntax</a></h3>
<blockquote>
<p><em>UseExpression</em> :<br />
<code>use</code> <em>StringLiteral</em></p>
</blockquote>
<h3 id="example"><a class="header" href="#example">Example</a></h3>
<pre><code>use ../path/to/goatfile
</code></pre>
<h3 id="explanation"><a class="header" href="#explanation">Explanation</a></h3>
<p>Foreign Goatfiles can be imported using the <code>use</code> statement.</p>
<p>Imported Goatfile behave like they are merged with the root Goatfile. So if you import a Goatfile <code>B</code> into a Goatfile <code>A</code>, all actions in all sections of <code>B</code> will be inserted infront of the actions in the sections of <code>A</code>. Meanwhile, the order of the sections <code>Setup</code>, <code>Tests</code> and <code>Teardown</code> stays intact.</p>
<p>Cyclic or repeated imports are forbidden.</p>
<p>Schematical Example:</p>
<p><code>A.goat</code></p>
<pre><code>use B

### Setup

GET A1

### Tests

GET A2

### Teardown

GET A3
</code></pre>
<p><code>B.goat</code></p>
<pre><code>### Setup

GET B1

### Tests

GET B2

### Teardown

GET B3
</code></pre>
<p><em>Result (virtual):</em></p>
<pre><code>### Setup

GET B1
GET A1

### Tests

GET B2
GET A2

### Teardown

GET B3
GET A3
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="execute-statement"><a class="header" href="#execute-statement">Execute Statement</a></h1>
<h3 id="syntax-1"><a class="header" href="#syntax-1">Syntax</a></h3>
<blockquote>
<p><em>ExecuteExpression</em> :<br />
<code>execute</code> <em>StringLiteral</em></p>
<p><em>Parameters</em> :<br />
<code>(</code> (<em>KeyValuePair</em> (<code>WS</code>|<code>NL</code>)+ )* <code>)</code> <em>ReturnStatement</em>?</p>
<p><em>ReturnStatement</em> :<br />
<code>(</code> (<em>ReturnStatement</em> (<code>WS</code>|<code>NL</code>)+ )* <code>)</code></p>
<p><em>ReturnPair</em> :<br />
<em>StringLiteral</em> <code>as</code> <em>StringLiteral</em></p>
<p><em>KeyValuePair</em> :<br />
<em>StringLiteral</em> <code>WS</code>* <code>=</code> <code>WS</code>* <em>StringLiteral</em></p>
</blockquote>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<pre><code>execute &quot;../utils/login&quot; (
  username=&quot;{{.credentials.username}}&quot;
  password=&quot;{{.credentials.password}}&quot;
) return (
  userId as userId
)
</code></pre>
<h3 id="explanation-1"><a class="header" href="#explanation-1">Explanation</a></h3>
<p>The <code>execute</code> statement allows to run a foreign Goatfile inside another Goatfile in it's own state context. Parameters for the executed Goatfile can be passed and values in the resulting state can be taken over into the calling Goatfile's state.</p>
<p>In contrast to the <code>use</code> directive, the executed Goatfile <em>A</em> is ran like a completely separate Goatfile execution with its own isolated state which does not share any values with the state of the executing file <em>B</em>. All parameters which shall be available in <em>A</em> must be passed as a list of key-value pairs. Resulting state values of <em>A</em> can then be captured to the state of <em>B</em> by listing them in the <code>return</code> statement with the name of the parameter in the state of <em>A</em> and the name the value shall be acessible in <em>B</em>.</p>
<p>Goatfiles executed are parsed in place, so they are only statically checked once they are executed within the executing Goatfile.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="sections"><a class="header" href="#sections">Sections</a></h1>
<h2 id="syntax-2"><a class="header" href="#syntax-2">Syntax</a></h2>
<blockquote>
<p><em>SectionDefinition</em> :<br />
<em>SectionHeader</em> <code>NL</code>+ <em>SectionContent</em></p>
<p><em>SectionHeader</em> :<br />
<code>###</code> <em>StringLiteral</em></p>
</blockquote>
<h2 id="example-2"><a class="header" href="#example-2">Example</a></h2>
<pre><code>### Tests

// ...
</code></pre>
<h2 id="explanation-2"><a class="header" href="#explanation-2">Explanation</a></h2>
<p>A section defines a discrete segment in a Goatfile. This can either be a specialized section like the <code>Defaults</code> section or a request section like <code>setup</code>, <code>tests</code> and <code>teardown</code>. More on these sections can be found in the <a href="goatfile/../explanations/test-lifecycle.html">Test Lifecycle Section</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defaults-section"><a class="header" href="#defaults-section">Defaults Section</a></h1>
<h2 id="syntax-3"><a class="header" href="#syntax-3">Syntax</a></h2>
<blockquote>
<p><em>DefaultsBlock</em> :<br />
<code>###</code> <code>defaults</code> <code>NL</code>+ <em>PartialRequestProperties</em>?</p>
</blockquote>
<h2 id="example-3"><a class="header" href="#example-3">Example</a></h2>
<pre><code>### Defaults

[Options]
storecookies = false

[Header]
Authorization: basic {{.token}}

[Script]
assert(response.StatusCode === 200);
</code></pre>
<h2 id="explanation-3"><a class="header" href="#explanation-3">Explanation</a></h2>
<p>The <code>Defaults</code> section body is structured like a request but without the header section. This includes the blocks <code>[Options]</code>, <code>[Header]</code>, <code>[QueryParams]</code>, <code>[Body]</code>, <code>[PreScript]</code> and <code>[Script]</code>. </p>
<p>Values specified in <code>[Header]</code>, <code>[Options]</code> and <code>[QueryParams]</code> will be merged with the values set in the requests. Values set in the request will overwrite values set in the defaults, if specified in both.</p>
<p>On the other hand, values specified in <code>[Body]</code>, <code>[PreScript]</code> or <code>[Script]</code> will be used if not specified in the requests. If these blocks are specified in the request, they will overwrite the default values as well.</p>
<p>Default values will also be applied if imported via a <code>use</code> directive.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="log-sections"><a class="header" href="#log-sections">Log Sections</a></h1>
<h2 id="syntax-4"><a class="header" href="#syntax-4">Syntax</a></h2>
<blockquote>
<p><em>LogSectionDefinition</em> :<br />
<code>#####</code> <em>Text</em> <code>NL</code></p>
</blockquote>
<h2 id="example-4"><a class="header" href="#example-4">Example</a></h2>
<pre><code>##### User Authentication Tests

// ...
</code></pre>
<h2 id="explanation-4"><a class="header" href="#explanation-4">Explanation</a></h2>
<p>A log section will produce a log output containing the given text to provide a visual separation between requests.</p>
<p>These sections can be used everywhere where requests can be specified as well.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="requests"><a class="header" href="#requests">Requests</a></h1>
<h2 id="syntax-5"><a class="header" href="#syntax-5">Syntax</a></h2>
<blockquote>
<p><em>RequestDefinition</em> :<br />
<em>RequestHeader</em> <code>NL</code> (<em>RequestBlock</em> <code>NL</code>)* <em>RequestDelimiter</em> <code>NL</code></p>
<p><em>RequestHeader</em> :<br />
<em>StringLiteral</em> <code>WS</code>+ <em>StringLiteral</em></p>
<p><em>RequestBlock</em> :<br />
<em>RequestBlockHeader</em> <code>NL</code> <em>RequestBlockContent</em></p>
<p><em>RequestDelimiter</em> :<br />
<code>---</code> <code>-</code>*</p>
</blockquote>
<h2 id="example-5"><a class="header" href="#example-5">Example</a></h2>
<pre><code>GET https://example.com/api/users

[Header]
Accept: application/json
Authentication: basic {{ .credentials.token }}

[Script]
assert(response.StatusCode === 200);

---
</code></pre>
<h2 id="explanation-5"><a class="header" href="#explanation-5">Explanation</a></h2>
<p>Define a request to be executed. The request definition starts with the request header consiting of the method followed by the URI (separated by one or more spaces). The request header is the only mandatory field for a valid request definition.</p>
<p>After that, you can specify more details about the request in different blocks. In the following documentation sections, all available blocks are listed and explained.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="method-and-url"><a class="header" href="#method-and-url">Method and URL</a></h1>
<h2 id="syntax-6"><a class="header" href="#syntax-6">Syntax</a></h2>
<blockquote>
<p><em>RequestHeader</em> :<br />
<em>StringLiteral</em> <code>WS</code>+ <em>StringLiteral</em></p>
</blockquote>
<h2 id="example-6"><a class="header" href="#example-6">Example</a></h2>
<pre><code>GET https://example.com/api/users
</code></pre>
<h2 id="explanation-6"><a class="header" href="#explanation-6">Explanation</a></h2>
<p>The request header defines the method and URL for a request and is the only mandatory element
to define a request.</p>
<p>The method can be any upcase string.</p>
<p>The URL can be either defined as an unquoted string literal or as a quoted string if spaces are required in the URL. Values in the URL can also be substituted.</p>
<p>✅ Valid</p>
<pre><code>GET https://example.com/api/users
</code></pre>
<p>✅ Valid</p>
<pre><code>GET https://example.com/api/users/{{.userId}}
</code></pre>
<p>✅ Valid</p>
<pre><code>GET &quot;https://example.com/api/users/some user&quot;
</code></pre>
<p>✅ Valid</p>
<pre><code>GET &quot;https://example.com/api/users/{{ .userId }}&quot;
</code></pre>
<p>❌ Invalid</p>
<pre><code>GET https://example.com/api/users/{{ .userId }}
</code></pre>
<p>❌ Invalid</p>
<pre><code>GET https://example.com/api/users/some user
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="options"><a class="header" href="#options">Options</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Options]</code> <code>NL</code>+ <em>RequestOptionsContent</em></p>
<p><em>RequestOptionsContent</em> :<br />
<em>TomlKeyValues</em></p>
</blockquote>
<h2 id="example-7"><a class="header" href="#example-7">Example</a></h2>
<pre><code class="language-toml">[Options]
cookiejar = &quot;admin&quot;
condition = {{ ifset . &quot;userId&quot; }}
delay = &quot;5s&quot;
</code></pre>
<h2 id="explanation-7"><a class="header" href="#explanation-7">Explanation</a></h2>
<p>Define additional options to the requests. The format of the contents of this block is <a href="https://toml.io/"><code>TOML</code></a>.</p>
<p>Option values can be substituted.</p>
<p>Below, all available otpions are explained.</p>
<h3 id="cookiejar"><a class="header" href="#cookiejar"><code>cookiejar</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>string</code> | <code>number</code></li>
<li><strong>Default</strong>: <code>&quot;default&quot;</code></li>
</ul>
<p>Defines the cookie jar to be used for saving and storing cookies. A cookie jar can be specified by either a number or a string. Every cookie jar defined contains a separate set of cookies collected from requests performed with that cookie jar specified.</p>
<h3 id="storecookies"><a class="header" href="#storecookies"><code>storecookies</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>true</code></li>
</ul>
<p>Defines if a cookie set by a requests response shall be stored in the cookie jar.</p>
<h3 id="sendcookies"><a class="header" href="#sendcookies"><code>sendcookies</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>true</code></li>
</ul>
<p>Defines if cookies stored in a cookie jar shall be sent to the server on request.</p>
<h3 id="noabort"><a class="header" href="#noabort"><code>noabort</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>false</code></li>
</ul>
<p>When enabled, a batch execution will not be canceled when the request execution or assertion failed.</p>
<h3 id="alwaysabort"><a class="header" href="#alwaysabort"><code>alwaysabort</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>false</code></li>
</ul>
<p>Forces a batch request to abort if the request execution or assertion failed even if the <code>--no-abort</code> CLI flag has been passed.</p>
<h3 id="condition"><a class="header" href="#condition"><code>condition</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>true</code></li>
</ul>
<p>Defines if a request shall be executed or not. This is usefull in combination with template substitution.</p>
<blockquote>
<p>In example, the following request will only be executed when <code>localAddress</code> is set in the current state.</p>
<pre><code>[Options]
condition = {{ ifset . &quot;localAddress&quot; }}
</code></pre>
</blockquote>
<h3 id="delay"><a class="header" href="#delay"><code>delay</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: <code>0</code></li>
</ul>
<p>A duration formatted as Go <a href="https://pkg.go.dev/time#ParseDuration">time.ParseDuration</a> compatible string which is awaited before the reqeust is executed.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="header"><a class="header" href="#header">Header</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Header]</code> <code>NL</code>+ <em>RequestHeaderContent</em></p>
<p><em>RequestHeaderContent</em> :<br />
<em>HeaderKV</em>*</p>
<p><em>HeaderKV</em> :<br />
<code>/[A-Za-z\-]+/</code> <code>:</code> <code>WS</code>* <code>/.*/</code> <code>NL</code></p>
</blockquote>
<h2 id="example-8"><a class="header" href="#example-8">Example</a></h2>
<pre><code class="language-toml">[Header]
Content-Type: application/json
Accept: application/json
X-Some-Custom-Header: foo bar bazz
</code></pre>
<h2 id="explanation-8"><a class="header" href="#explanation-8">Explanation</a></h2>
<p>Define HTTP headers sent with the request in the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages#headers">HTTP conform header representation</a>.</p>
<p>Values in the header value field can be substituted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="queryparams"><a class="header" href="#queryparams">QueryParams</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Options]</code> <code>NL</code>+ <em>RequestOptionsContent</em></p>
<p><em>RequestOptionsContent</em> :<br />
<em>TomlKeyValues</em></p>
</blockquote>
<h2 id="example-9"><a class="header" href="#example-9">Example</a></h2>
<pre><code class="language-toml">[QueryParams]
page = {{.page}}
count = 100
field = [&quot;username&quot;, &quot;age&quot;, &quot;id&quot;]
token = &quot;{{.apitoken}}&quot;
</code></pre>
<h2 id="explanation-9"><a class="header" href="#explanation-9">Explanation</a></h2>
<p>Define additional query parameters which will be appended to the request URL. The format of the contents of this block is <a href="https://toml.io/"><code>TOML</code></a>.</p>
<p>An array of values will be representet as a repetition of the same query parameter with the different contained values assigned.</p>
<blockquote>
<p>The example from above results in the following query parameters.</p>
<pre><code>page=5&amp;count=100&amp;field=username&amp;field=age&amp;field=id
</code></pre>
</blockquote>
<p>Parameter values can be subsituted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="body"><a class="header" href="#body">Body</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Body]</code> <code>NL</code>+ <em>RequestBodyContent</em></p>
<p><em>RequestBodyContent</em> :<br />
<em>BlockDelimitedContent</em> | <em>UndelimitedContent</em></p>
<p><em>BlockDelimitedContent</em> :<br />
<em>BlockDelimiter</em> <code>NL</code> <code>/.*/</code> <code>NL</code> <em>BlockDelimiter</em></p>
<p><em>UndelimitedContent</em> :<br />
(<code>/.*/</code> <code>NL</code>)* <code>NL</code></p>
<p><em>BlockDelimiter</em> :<br />
<code>```</code></p>
</blockquote>
<h2 id="example-10"><a class="header" href="#example-10">Example</a></h2>
<pre><code class="language-toml">[Body]
```
{
  &quot;user&quot;: {
    &quot;name&quot;: &quot;{{.userName}}&quot;,
    &quot;favorite_programming_langs&quot;: [
      &quot;Go&quot;,
      &quot;Rust&quot;
    ],
  }
}
```
</code></pre>
<h2 id="explanation-10"><a class="header" href="#explanation-10">Explanation</a></h2>
<p>Define HTTP headers sent with the request in the <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages#headers">HTTP conform header representation</a>.</p>
<p>If you want to use the parameter braces (<code>{{</code>, <code>}}</code>) without substitution, you can escape them using a backslash.</p>
<p>Example:</p>
<pre><code class="language-toml">[Body]
```
{
  &quot;user&quot;: {
    &quot;name&quot;: &quot;\{\{This will not be substituted\}\}&quot;,
    &quot;favorite_programming_langs&quot;: [
      &quot;Go&quot;,
      &quot;Rust&quot;
    ],
  }
}
```
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prescript"><a class="header" href="#prescript">PreScript</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[PreScript]</code> <code>NL</code>+ <em>RequestPreScriptContent</em></p>
<p><em>RequestPreScriptContent</em> :<br />
<em>BlockDelimitedContent</em> | <em>UndelimitedContent</em></p>
<p><em>BlockDelimitedContent</em> :<br />
<em>BlockDelimiter</em> <code>NL</code> <code>/.*/</code> <code>NL</code> <em>BlockDelimiter</em></p>
<p><em>UndelimitedContent</em> :<br />
(<code>/.*/</code> <code>NL</code>)* <code>NL</code></p>
<p><em>BlockDelimiter</em> :<br />
<code>```</code></p>
</blockquote>
<h2 id="example-11"><a class="header" href="#example-11">Example</a></h2>
<pre><code class="language-toml">[PreScript]
```
var fileName = requestedFile.Metadata.Name;
```
</code></pre>
<h2 id="explanation-11"><a class="header" href="#explanation-11">Explanation</a></h2>
<p>A script section which is evaluated before the actual request is substituted and performed. This can be used to put values from previous responses into variables which can then be later on used in the request parameters.</p>
<p>Example:</p>
<pre><code>POST http://example.com/api/user

[Body]
// ...

[Script]
assert(response.StatusCode === 201);
var user = response.BodyJson;

---

GET http://example.com/api/user/{{.userid}}

[PreScript]
var userid = user.id;
</code></pre>
<p><code>PreScript</code> will always be executed before the request parameters are substituted. So you can use the results in various fields like <code>[Options]</code> or <code>[Body]</code>, <code>Header</code> or <code>[Script]</code>.</p>
<p>Scripts are written in ES5.1 conform JavaScript. More on that can be found in the <a href="goatfile/requests/./script.html">Script</a> section documentation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="script"><a class="header" href="#script">Script</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Script]</code> <code>NL</code>+ <em>RequestPreScriptContent</em></p>
<p><em>RequestPreScriptContent</em> :<br />
<em>BlockDelimitedContent</em> | <em>UndelimitedContent</em></p>
<p><em>BlockDelimitedContent</em> :<br />
<em>BlockDelimiter</em> <code>NL</code> <code>/.*/</code> <code>NL</code> <em>BlockDelimiter</em></p>
<p><em>UndelimitedContent</em> :<br />
(<code>/.*/</code> <code>NL</code>)* <code>NL</code></p>
<p><em>BlockDelimiter</em> :<br />
<code>```</code></p>
</blockquote>
<h2 id="example-12"><a class="header" href="#example-12">Example</a></h2>
<pre><code class="language-toml">[Script]
```
assert(response.StatusCode === 200, `Response status code was ${response.StatusCode}`);
assert(response.BodyJson.UserName === &quot;Foo Bar&quot;);
```
</code></pre>
<h2 id="explanation-12"><a class="header" href="#explanation-12">Explanation</a></h2>
<p>A script section which is executed after a request has been performed and responded to. This is generally used to assert response values like status codes, header values or body content.</p>
<p>Scripts are written in ES5.1 conform JavaScript.</p>
<p>The context of the script always contains the current values in the batch state as global variables.</p>
<p>A special variable set in each <code>[Script]</code> section is the <code>response</code> variable, which contains all information about the request response. The <code>Response</code> object contains the following fields.</p>
<pre><code class="language-go">type Response struct {
	StatusCode    int
	Status        string
	Proto         string
	ProtoMajor    int
	ProtoMinor    int
	Header        map[string][]string
	ContentLength int64
	Body          string
	BodyJson      any
}
</code></pre>
<p><code>BodyJson</code> is a special field containing the response body content as a JavaScript object which will be populated when the response body can be parsed as a JSON object.</p>
<p>In any script section, you can used built-in functions like <code>assert</code>, which are documented <a href="goatfile/requests/../../scripting/builtins.html">here</a>.</p>
<p>When a script section throws an un-catched exception, the test will be evaluated as <em>failed</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="templating"><a class="header" href="#templating">Templating</a></h1>
<p>One of the most powerful features of Goat is the ability to use variables from the state in almost every value field in a request definition.</p>
<p>These values are substituted using the powerful templating engine of Go. We will only go over the most basic syntax. Please review the <a href="https://pkg.go.dev/text/template">Go template documentation</a> for full details.</p>
<h2 id="syntax-7"><a class="header" href="#syntax-7">Syntax</a></h2>
<p>Template parameters in Goatfiles are defined inside double-braces (<code>{{ }}</code>). Variables from the state are referenced using a dot-notation. Let's take a look at the following example.</p>
<p>We have the following state.</p>
<pre><code class="language-yml">instance: &quot;http://example.com&quot;

credentials:
  username: &quot;foobar&quot;
  password: &quot;password&quot;
</code></pre>
<p>Now, we can reference the values in our state as following.</p>
<pre><code>POST {{.instance}}/api/v1/auth/login

[Body]
{
  &quot;username&quot;: &quot;{{.credentials.username}}&quot;
  &quot;password&quot;: &quot;{{.credentials.password}}&quot;
}
</code></pre>
<p>Functions can be called using the name of the function followed by the parameters separated by spaces. Lets take a look at the followign example.</p>
<p>Weassume the following state.</p>
<pre><code class="language-yaml">name: &quot;Max&quot;
</code></pre>
<pre><code>{{ printf &quot;Hello, %s!&quot; .name }}
</code></pre>
<p>This will result in the string value <code>&quot;Hello, Max!&quot;</code>.</p>
<p>There are also a lot of <a href="templating/./builtins.html">builtin functions</a> you can use in your Goatfiles.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="builtins"><a class="header" href="#builtins">Builtins</a></h1>
<p>The following builtin functions are available in templates used in Goatfiles.</p>
<h2 id="base64"><a class="header" href="#base64"><code>base64</code></a></h2>
<pre><code>base64 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the input <code>value</code> as base64 encoded string.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ base64 &quot;hello world&quot; }}
</code></pre>
<h2 id="base64url"><a class="header" href="#base64url"><code>base64url</code></a></h2>
<pre><code>base64url &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the input <code>value</code> as base64 URL encoded string.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ base64url &quot;hello world&quot; }}
</code></pre>
<h2 id="md5"><a class="header" href="#md5"><code>md5</code></a></h2>
<pre><code>md5 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the HEX encoded MD5 hash of the given input <code>value</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ md5 &quot;hello world&quot; }}
</code></pre>
<h2 id="sha1"><a class="header" href="#sha1"><code>sha1</code></a></h2>
<pre><code>sha1 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the HEX encoded SHA1 hash of the given input <code>value</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ sha1 &quot;hello world&quot; }}
</code></pre>
<h2 id="sha256"><a class="header" href="#sha256"><code>sha256</code></a></h2>
<pre><code>sha256 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the HEX encoded SHA256 hash of the given input <code>value</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ sha256 &quot;hello world&quot; }}
</code></pre>
<h2 id="sha512"><a class="header" href="#sha512"><code>sha512</code></a></h2>
<pre><code>sha512 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the HEX encoded SHA512 hash of the given input <code>value</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ sha512 &quot;hello world&quot; }}
</code></pre>
<h2 id="randomstring"><a class="header" href="#randomstring"><code>randomString</code></a></h2>
<pre><code>randomString &lt;length?: integer&gt; -&gt; string
</code></pre>
<p>Returns a random string with the given length. If no length is passed, the default length is 8 characters.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ randomString 16 }}
</code></pre>
<h2 id="randomint"><a class="header" href="#randomint"><code>randomInt</code></a></h2>
<pre><code>randomInt &lt;n?: integer&gt; -&gt; int
</code></pre>
<p>Returns a random integer in the range <code>[0, n)</code> where <code>n</code> is given as parameter. if no parameter is passed, <code>n</code> defaults to the max int value.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ randomInt 256 }}
</code></pre>
<h2 id="timestamp"><a class="header" href="#timestamp"><code>timestamp</code></a></h2>
<pre><code>timestamp &lt;format?: string&gt; -&gt; string
</code></pre>
<p>Returns the current timestamo in the given format. The format is specified in <a href="https://pkg.go.dev/time">Go's time format</a>. If no format is given, the time is returned as Unix seconds string.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ timestamp &quot;Mon, 02 Jan 2006 15:04:05 MST&quot; }}
</code></pre>
<h2 id="isset"><a class="header" href="#isset"><code>isset</code></a></h2>
<pre><code>timestamp &lt;map: map[string]any&gt; &lt;key: string&gt; -&gt; bool
</code></pre>
<p>Returns <code>true</code> when the given <code>key</code> is present and its corresponding value is not <code>nil</code> in the given <code>map</code>. Otherwise, <code>false</code> is returned.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ isset . &quot;username&quot; }}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scripting"><a class="header" href="#scripting">Scripting</a></h1>
<p>Scripting sections like <code>[Script]</code> and <code>[PreScript]</code> use a dedicated scripting micro-engine for maximum flexibility in your test setup and procedures.</p>
<p>Goat uses ES5.1 conform JavaScript interpreted by the <a href="https://github.com/dop251/goja">goja</a> micro-engine.</p>
<p>In each script instance, you have access to the current state values via the global environment variables. Also, you can define global variables using the <code>var</code> statement to define values which will be set to the state after successful script execution.</p>
<p>Example:</p>
<blockquote>
<p>Initial State</p>
<pre><code class="language-toml">foo = 1
</code></pre>
</blockquote>
<blockquote>
<p>Script Execution</p>
<pre><code class="language-js">var bar = foo * 2;
</code></pre>
</blockquote>
<blockquote>
<p>Resulting State</p>
<pre><code class="language-toml">foo = 1
bar = 2
</code></pre>
</blockquote>
<p>Also, some <a href="scripting/./builtins.html">builtins</a> are available in each script instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="builtins-1"><a class="header" href="#builtins-1">Builtins</a></h1>
<p>The following builtin functions are available in each script instance.</p>
<h2 id="assert"><a class="header" href="#assert"><code>assert</code></a></h2>
<pre><code class="language-ts">function assert(expression: bool, fail_message?: string): void;
</code></pre>
<p>Takes an <code>expression</code> which, when evaluated to <code>false</code>, will throw an assert exception. You can pass an additional <code>fail_message</code> which will be shown in the exception. This can be used to assert values in responses and fail test execution if they are false.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">assert(response.StatusCode &gt;= 400, `Status code was ${response.StatusCode}`);
</code></pre>
<h2 id="print"><a class="header" href="#print"><code>print</code></a></h2>
<pre><code class="language-ts">function print(...message: string[]): void;
</code></pre>
<p>Prints the given <code>message</code> to the terminal without a leading new line.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">print(&quot;Hello world!&quot;);
</code></pre>
<h2 id="println"><a class="header" href="#println"><code>println</code></a></h2>
<pre><code class="language-ts">function println(...message: string[]): void;
</code></pre>
<p>Prints the given <code>message</code> to the terminal with a leading new line.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">println(&quot;Hello world!&quot;);
</code></pre>
<h2 id="info"><a class="header" href="#info"><code>info</code></a></h2>
<pre><code class="language-ts">function info(...message: string[]): void;
</code></pre>
<p>Logs an <em>info</em> log entry to the output logger(s) with the given <code>message</code>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">info(&quot;Hello world!&quot;);
</code></pre>
<h2 id="warn"><a class="header" href="#warn"><code>warn</code></a></h2>
<pre><code class="language-ts">function warn(...message: string[]): void;
</code></pre>
<p>Logs an <em>warn</em> log entry to the output logger(s) with the given <code>message</code>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">warn(&quot;Hello world!&quot;);
</code></pre>
<h2 id="error"><a class="header" href="#error"><code>error</code></a></h2>
<pre><code class="language-ts">function error(...message: string[]): void;
</code></pre>
<p>Logs an <em>error</em> log entry to the output logger(s) with the given <code>message</code>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">error(&quot;Hello world!&quot;);
</code></pre>
<h2 id="fatal"><a class="header" href="#fatal"><code>fatal</code></a></h2>
<pre><code class="language-ts">function fatal(...message: string[]): void;
</code></pre>
<p>Logs an <em>fatal</em> log entry to the output logger(s) with the given <code>message</code>. This will also abort the batch execution.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">fatal(&quot;Hello world!&quot;);
</code></pre>
<h2 id="debug"><a class="header" href="#debug"><code>debug</code></a></h2>
<pre><code class="language-ts">function debug(...message: string[]): void;
</code></pre>
<p>Logs an <em>debug</em> log entry to the output logger(s) with the given <code>message</code>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">debug(&quot;Hello world!&quot;);
</code></pre>
<h2 id="infof"><a class="header" href="#infof"><code>infof</code></a></h2>
<pre><code class="language-ts">function infof(format: string, ...values: any[]): void;
</code></pre>
<p>Logs an <em>info</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">infof(&quot;Hello %s!&quot;, &quot;World&quot;);
</code></pre>
<h2 id="warnf"><a class="header" href="#warnf"><code>warnf</code></a></h2>
<pre><code class="language-ts">function warnf(format: string, ...values: any[]): void;
</code></pre>
<p>Logs an <em>warn</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">warnf(&quot;Hello %s!&quot;, &quot;World&quot;);
</code></pre>
<h2 id="errorf"><a class="header" href="#errorf"><code>errorf</code></a></h2>
<pre><code class="language-ts">function errorf(format: string, ...values: any[]): void;
</code></pre>
<p>Logs an <em>error</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">errorf(&quot;Hello %s!&quot;, &quot;World&quot;);
</code></pre>
<h2 id="fatalf"><a class="header" href="#fatalf"><code>fatalf</code></a></h2>
<pre><code class="language-ts">function fatalf(format: string, ...values: any[]): void;
</code></pre>
<p>Logs an <em>fatal</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>. This will also abort the batch execution.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">fatalf(&quot;Hello %s!&quot;, &quot;World&quot;);
</code></pre>
<h2 id="debugf"><a class="header" href="#debugf"><code>debugf</code></a></h2>
<pre><code class="language-ts">function debugf(format: string, ...values: any[]): void;
</code></pre>
<p>Logs an <em>debug</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">debugf(&quot;Hello %s!&quot;, &quot;World&quot;);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h1>
<p>When you write extensive integration tests for your products, you can use different strategies to re-use often utilized snippets. In this document, you will find some inspiration on how large sets of Goatfiles can be structured.</p>
<h2 id="zentralizing-commonly-used-snippets"><a class="header" href="#zentralizing-commonly-used-snippets">Zentralizing commonly used snippets</a></h2>
<p>As you might know, you can extract often used snippets into their own Goatfiles which then can be re-used in other files either via the <a href="project-structure/../goatfile/import-statement.html"><code>use</code></a> or via the <a href="project-structure/../goatfile/execute-statement.html"><code>execute</code></a> statement.</p>
<p>If you have multiple projects which share similar backend logic, the best approach is to collect shared routines in a separate dependency. For example, you could create a separate git repository with some utility Goatfiles which is then added as a git sub-module to your main projects. Make sure to prefix the name of the target directory in your projects with an underscore (<code>_</code>), so that the Goat CLI will not try to execute them by accident. </p>
<p>Example use-cases for that could be</p>
<ul>
<li>logging in with one or more user accounts</li>
<li>setting default headers for all requests</li>
<li>encapsuling common procedures like creating and cleaning up entities</li>
</ul>
<h2 id="file-structure"><a class="header" href="#file-structure">File Structure</a></h2>
<p>In our projects at B12 Touch, we employ the following file structure for API integration tests in all our projects. Maybe you can use this for inspiration for your own structure.</p>
<pre><code>integrationtests/
├── _shed/
├── issues/
│   └── 123/
│       └── main.goat
├── tests/
│   └── users/
│       ├── _util.goat
│       ├── create.goat
│       ├── list.goat
│       └── delete.goat
├── params.toml.template
├── local.toml
├── staging.toml
└── ci.toml
</code></pre>
<p>As you can see, we have a directory called <code>integrationtests/</code> in all of our projects which contains all tests, test utilities as well as parameter files.</p>
<p><code>_shed/</code> is the name of our dependency containing some utility Goatfiles used i.e. to create new users, log in with users with different permissions, set request defaults and much more. As you can see, this directory is prefixed with <code>_</code>, so it will not be executed when calling Goat on the <code>integrationtests/</code> directory.</p>
<p><code>issues/</code> contains sub-directories with the name of tickets on our issue board. These are there to demonstrate misbehaviour cases of our API, so these tests should fail on the latest dev state. These can also be used to test against fixes of these issues. When the issue is resolved, these tests should be moved into the respective <code>tests/</code> sub-directory.</p>
<p><code>tests/</code> contains the actual integration tests grouped by features. These tests should always pass against the latest dev state, otherwise something might be broken.</p>
<p>We use some user-secific parameters passed into the tests which are stored in different <code>*.toml</code> files in the <code>integrationtests/</code> directory. These should be specified in the projects <code>.gitignore</code> because every developer might have their own parameters like API keys or user credentials. You could also put a parameter file for automatic tests in there (like the <code>ci.toml</code> in our example) which is commited into the repository. The <code>params.toml.template</code> is a template file to base custom parameter files on. This is handy because the integration tests expect specific parameters to work with. An example <code>params.toml.template</code> could look as following.</p>
<pre><code class="language-toml"># The server instance to connect to.
instance = &quot;http://localhost:10001&quot;

# Credentials for a user with non-admin privileges.
[credentials.low]
username = &quot;test@test&quot;
password = &quot;password&quot;
apikey = &quot;some api key&quot;

# Credentiasl for a user with admin privileges.
[credentials.admin]
username = &quot;root@root&quot;
password = &quot;password&quot;
apikey = &quot;some api key&quot;
</code></pre>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>To simplify the usage of our Goatfiles, we employ a system of documentation what a spefici Goatfile does, which parameters it expects and – if it is a Goatfile meant to be execuetd or used in other Goatfiles – which state variables it creates which can be further used or captured in an exec's return statement.</p>
<p>The documentation is prefixed with three forward slashes and sits on the very top of the Goatfile. First, stating the purpose of the file followed by required parameters. After that, you can specify the variables created in the execution in the same manner.</p>
<p>Lets take the following as an example for a Goatfile which can be imported in your test to log in two users with two different privilege groups.</p>
<pre><code>/// Logs in with a `low` and an `admin` user to the SSP and stores
/// the session in the `default` cookiejar for the `low` user and
/// in the `admin` cookiejar for the `admin` user.
/// 
/// 
/// Required Parameters
/// -----------------------------------------------------------------------
/// instance:                       The root address of the API instance.
/// credentials.low.username:       Username of the `low` user
/// credentials.low.password:       Password of the `low` user
/// credentials.admin.username:     Username of the `admin` user
/// credentials.admin.password:     Password of the `admin` user
/// 
/// 

### Setup

POST {{.instance}}/api/auth/login

[Header]
Content-Type: application/json

[Body]
{
  &quot;username&quot;: &quot;{{.credentials.low.username}}&quot;,
  &quot;password&quot;: &quot;{{.credentials.low.password}}&quot;
}

[Script]
assert(response.StatusCode == 200, `Status code was ${response.StatusCode}`);

---

POST {{.instance}}/api/auth/login

[Options]
cookiejar = &quot;admin&quot;

[Header]
Content-Type: application/json


[Body]
{
  &quot;username&quot;: &quot;{{.credentials.admin.username}}&quot;,
  &quot;password&quot;: &quot;{{.credentials.admin.password}}&quot;
}

[Script]
assert(response.StatusCode == 200, `Status code was ${response.StatusCode}`);

---
</code></pre>
<p>Here you can find an example for a Goatfile which is created to be used with the <code>execute</code> statement in another Goatfile.</p>
<pre><code>/// Creates a new user.
/// 
/// 
/// Parameters
/// -----------------------------------------------------------------------
/// instance:   The root address of the API instance.
/// username:   User name of the new user.
/// password:   Password of the new user.
/// 
///
/// Returns
/// -----------------------------------------------------------------------
/// userid:     The ID of the new user.


// ...
</code></pre>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="js/mermaid.min.js"></script>
        <script src="js/mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
