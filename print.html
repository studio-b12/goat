<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Goat</title>
        <meta name="robots" content="noindex">


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="introduction/glossary.html"><strong aria-hidden="true">1.1.</strong> Glossary</a></li></ol></li><li class="chapter-item expanded "><a href="getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="command-line-tool/index.html"><strong aria-hidden="true">3.</strong> Command Line Tool</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="command-line-tool/profiles.html"><strong aria-hidden="true">3.1.</strong> Profiles</a></li></ol></li><li class="chapter-item expanded "><a href="explanations/index.html"><strong aria-hidden="true">4.</strong> How does it work?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="explanations/state.html"><strong aria-hidden="true">4.1.</strong> State Management</a></li><li class="chapter-item expanded "><a href="explanations/lifecycle.html"><strong aria-hidden="true">4.2.</strong> Lifecycle</a></li></ol></li><li class="chapter-item expanded "><a href="goatfile/index.html"><strong aria-hidden="true">5.</strong> Goatfile</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="goatfile/comments.html"><strong aria-hidden="true">5.1.</strong> Comment</a></li><li class="chapter-item expanded "><a href="goatfile/import-statement.html"><strong aria-hidden="true">5.2.</strong> Import Statement</a></li><li class="chapter-item expanded "><a href="goatfile/execute-statement.html"><strong aria-hidden="true">5.3.</strong> Execute Statement</a></li><li class="chapter-item expanded "><a href="goatfile/sections.html"><strong aria-hidden="true">5.4.</strong> Section</a></li><li class="chapter-item expanded "><a href="goatfile/defaults-section.html"><strong aria-hidden="true">5.5.</strong> Defaults Section</a></li><li class="chapter-item expanded "><a href="goatfile/logsections.html"><strong aria-hidden="true">5.6.</strong> Log Section</a></li><li class="chapter-item expanded "><a href="goatfile/requests/index.html"><strong aria-hidden="true">5.7.</strong> Request</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="goatfile/requests/method-and-url.html"><strong aria-hidden="true">5.7.1.</strong> Method and URL</a></li><li class="chapter-item expanded "><a href="goatfile/requests/options.html"><strong aria-hidden="true">5.7.2.</strong> Options</a></li><li class="chapter-item expanded "><a href="goatfile/requests/header.html"><strong aria-hidden="true">5.7.3.</strong> Headers</a></li><li class="chapter-item expanded "><a href="goatfile/requests/query-params.html"><strong aria-hidden="true">5.7.4.</strong> Query Parameters</a></li><li class="chapter-item expanded "><a href="goatfile/requests/auth.html"><strong aria-hidden="true">5.7.5.</strong> Auth</a></li><li class="chapter-item expanded "><a href="goatfile/requests/body.html"><strong aria-hidden="true">5.7.6.</strong> Body</a></li><li class="chapter-item expanded "><a href="goatfile/requests/formdata.html"><strong aria-hidden="true">5.7.7.</strong> FormData</a></li><li class="chapter-item expanded "><a href="goatfile/requests/prescript.html"><strong aria-hidden="true">5.7.8.</strong> PreScript</a></li><li class="chapter-item expanded "><a href="goatfile/requests/script.html"><strong aria-hidden="true">5.7.9.</strong> Script</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="templating/index.html"><strong aria-hidden="true">6.</strong> Templating</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="templating/builtins.html"><strong aria-hidden="true">6.1.</strong> Built-ins</a></li></ol></li><li class="chapter-item expanded "><a href="scripting/index.html"><strong aria-hidden="true">7.</strong> Scripting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="scripting/builtins.html"><strong aria-hidden="true">7.1.</strong> Built-ins</a></li></ol></li><li class="chapter-item expanded "><a href="project-structure/index.html"><strong aria-hidden="true">8.</strong> Project Structure</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Goat</h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="-goat"><a class="header" href="#-goat">🐐 Goat</a></h1>
<p>goat <em>(<strong>Go</strong> <strong>A</strong>PI <strong>T</strong>ester)</em>, a CLI tool to simplify and automate integration testing of HTTP APIs by using script files.</p>
<p><img src="introduction/../assets/demo.gif" alt="" /></p>
<blockquote>
<p>Example Goatfile</p>
<pre><code>use util/login

### Setup

LOGIN {{.instance}}/api/v1/auth

[Header]
Content-Type: application/json

[Body]
{ 
    "username": "{{.username}}",
    "password": "{{.password}}"
}

[Script]
assert(response.StatusCode == 200, `Status code was ${response.StatusCode}`);

---

### Tests

GET {{.instance}}/api/v1/list

[Script]
assert(response.StatusCode == 200, `Status code was ${response.StatusCode}`);
print(response.Body);
</code></pre>
</blockquote>
<h2 id="-hey-and-welcome-to-the-goat-documentation"><a class="header" href="#-hey-and-welcome-to-the-goat-documentation">📖 Hey and welcome to the Goat documentation!</a></h2>
<p>Here you will learn how to use the Goat CLI tool and how to write Goatfiles.</p>
<p>For better understanding and conciseness, we highly suggest to take a look at the <a href="introduction//introduction/glossary.html">Glossary</a> before continuing into the documentation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="glossary"><a class="header" href="#glossary">Glossary</a></h1>
<p>To make this documentation more concise and understandable, here you can find a list of all special terms and their definitions used across the documentation.</p>
<ul>
<li><code>Goatfile</code> - A file with the extension <code>.goat</code> which is interpreted and executed by the Goat CLI.</li>
<li><code>action</code> - Can be any executable entity defined in a Goatfile like a request, log entry or execution.</li>
<li><code>batch</code> - Defines the execution of multiple requests and actions across one or multiple Goatfiles.</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="getting-started"><a class="header" href="#getting-started">Getting Started</a></h1>
<h2 id="installation"><a class="header" href="#installation">Installation</a></h2>
<h3 id="pre-built-binaries"><a class="header" href="#pre-built-binaries">Pre-Built Binaries</a></h3>
<p>First of all, you need to install the <code>goat</code> CLI tool. It is distributed as a single binary without any dependencies. So simply download the <a href="https://github.com/studio-b12/goat/releases"><strong>latest release binaries from GitHub</strong></a> fitting your system configuration.</p>
<p>You can also use the provided <a href="https://github.com/studio-b12/goat/blob/main/scripts/download.sh">installation script</a>, if you want an easy one-line setup.</p>
<pre><code class="language-bash">$ curl -Ls https://raw.githubusercontent.com/studio-b12/goat/main/scripts/download.sh | bash -
</code></pre>
<h3 id="installation-with-go-install"><a class="header" href="#installation-with-go-install">Installation with <code>go install</code></a></h3>
<p>Alternatively, if you have the Go toolchain installed on your system, you can also simply use <code>go install</code> to build and install the tool for your system. This is also very useful if no pre-built binary is available for your specific system configuration.</p>
<blockquote>
<p>Details on how to install the Go toolchain are available <a href="https://go.dev/doc/install">here</a>.</p>
</blockquote>
<p>Simply use the following command to install the program.</p>
<pre><code>go install github.com/studio-b12/goat/cmd/goat@latest
</code></pre>
<p>This will install the latest tagged version. You can also specify a specific version or branch after the <code>@</code>.</p>
<pre><code>go install github.com/studio-b12/goat/cmd/goat@dev
</code></pre>
<h2 id="first-goatfile"><a class="header" href="#first-goatfile">First Goatfile</a></h2>
<p>After that, simply use the following command to initalize a new Goatfile.</p>
<pre><code>goat --new
</code></pre>
<p>This will generate a new Goatfile with the name <code>tests.goat</code> in your current working directory with some simple examples and documentation. You can use this file as your starting point to play around with Goat or to create your project's integration test structure.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="command-line-tool"><a class="header" href="#command-line-tool">Command Line Tool</a></h1>
<p>The <code>goat</code> command is used to create, validate and execute Goatfiles.</p>
<p>You can pass one or multiple Goatfiles or directories as positional arguments. For example:</p>
<pre><code>goat issue_32.goat tests/integrationtests
</code></pre>
<p>When passing in a directory, Goat will look for any <code>*.goat</code> files recursively. Files and directories prefixed with an underscore (<code>_</code>) are ignored. This is especially useful for Goatfiles which are only supposed to be imported or executed in other Goatfiles. If you want to read more about this, take a look into the <a href="command-line-tool/../project-structure/index.html">Project Structure section</a>.</p>
<h2 id="flags"><a class="header" href="#flags">Flags</a></h2>
<p>In the following, further information is provided about the various flags which can be passed to the <code>goat</code> CLI.</p>
<ul>
<li>
<p><strong><code>-a ARGS</code>, <code>--args ARGS</code></strong><br />
Pass params into the execution as key-value pairs. If you want to pass multiple args, specify each pair with its own parameter.<br />
<em>Example: <code>-a hello=world -a user.name=foo -a "user.password=bar bazz"</code></em></p>
</li>
<li>
<p><strong><code>--delay DELAY</code>, <code> -d DELAY</code></strong><br />
Delay all requests by the given duration. The duration is formatted according to the format of Go's <a href="https://pkg.go.dev/time#ParseDuration"><code>time.ParseDuration</code></a> function.<br />
<em>Example: <code>-d 1m30s</code></em></p>
</li>
<li>
<p><strong><code>--dry</code></strong><br />
Only parse the Goatfile(s) without executing any requests.</p>
</li>
<li>
<p><strong><code>--gradual</code>, <code> -g</code></strong><br />
Advance the execution of each request manually via key-presses.</p>
</li>
<li>
<p><strong><code>--json</code></strong><br />
Use JSON format instead of pretty console format for logging.</p>
</li>
<li>
<p><strong><code>--loglevel LOGLEVEL</code>, <code> -l LOGLEVEL</code></strong><br />
Logging level. <a href="https://github.com/zekroTJA/rogu#levels">Here</a> you can see which values you can use for log levels.<br />
<em>Example: <code>-l trace</code></em></p>
</li>
<li>
<p><strong><code>--new</code></strong><br />
Create a new base Goatfile. When a file directory name is passed as positional parameter, the new Goatfile will be created under that directory name.</p>
</li>
<li>
<p><strong><code>--no-abort</code></strong><br />
Do not abort the batch execution on error.</p>
</li>
<li>
<p><strong><code>--no-color</code></strong><br />
Suppress colored log output.</p>
</li>
<li>
<p><strong><code>--params PARAMS</code>, <code> -p PARAMS</code></strong><br />
Pass parameters defined in parameter files. These can be either TOML, YAML or JSON files. If you want to pass multiple parameter files, specify each one with its own parameter.<br />
<em>Example: <code>-p ./local.toml -p ~/credentials.yaml</code></em></p>
</li>
<li>
<p><strong><code>--profile PROFILE</code>, <code>-P PROFILE</code></strong><br />
Use parameters from profiles defined in a profile config in your home's configuration directory. <a href="command-line-tool/./profiles.html">Here</a> you can read more about how profiles work.<br />
<em>Example: <code>-P foo -P bar</code></em></p>
</li>
<li>
<p><strong><code>--reduced-errors</code>, <code>-R</code></strong><br />
Hide template errors in teardown steps. This can be useful when running tests to hide some noise from failing teardown steps due to missing variables.</p>
</li>
<li>
<p><strong><code>--silent</code>, <code> -s</code></strong><br />
Disable all logging output. Only <code>print</code> and <code>println</code> statements will be printed. This is especially useful if you want to use Goatfiles within other scripts.</p>
</li>
<li>
<p><strong><code>--skip SKIP</code></strong><br />
Section(s) to be skipped during execution.<br />
<em>Example: <code>--skip teardown</code></em></p>
</li>
<li>
<p><strong><code>--secure</code></strong><br />
Enable TLS certificate validation.</p>
</li>
<li>
<p><strong><code>--help</code>, <code> -h</code></strong><br />
Display the help message.</p>
</li>
<li>
<p><strong><code>--version</code></strong><br />
Display the installed version.</p>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="profiles"><a class="header" href="#profiles">Profiles</a></h1>
<p>Profiles are like parameter files but located in a central file in your home config directory and usable from everywhere.
This should solve the problem when you have similar parameters across multiple projects, so you don't need to duplicate them
everywhere or figure out the path to your centrally stored parameter files.</p>
<p>The location of this file depends on your system type.</p>
<div class="table-wrapper"><table><thead><tr><th>Operating System</th><th>Location</th></tr></thead><tbody>
<tr><td>Linux</td><td><code>$HOME/.config/goat/profiles*</code><br /><em>or <code>$XDG_CONFIG_HOME/goat/profiles.*</code> if <code>$XDG_CONFIG_HOME</code> is set</em></td></tr>
<tr><td>Darwin (OSX)</td><td><code>$HOME/Library/Application Support/goat/profiles.*</code></td></tr>
<tr><td>Windows</td><td><code>%AppData%\goat\profiles.*</code></td></tr>
</tbody></table>
</div>
<p>Goat looks for any file in the config directory called <code>profiles.*</code>. Supported file types and extensions are as follows.</p>
<ul>
<li><code>.toml</code></li>
<li><code>.yaml</code> or <code>.yml</code></li>
<li><code>.json</code></li>
</ul>
<p>The structure of a profile file consists of a top level map containing the names of the profiles as keys and the parameter
maps as values.</p>
<p>Here is a quick example.</p>
<pre><code class="language-yaml">default:
  instance: https://example.com
  credentials:
    token: foobar

staging:
  instance: https://staging.example.com
  credentials:
    token: barbaz

lowprevileges:
  credentials:
    token: lowtoken

local:
  instance: https://localhost:8080
</code></pre>
<p>Profiles can be addressed when calling <code>goat</code> with the <code>--profile</code> (or <code>-P</code>) parameter. You can define multiple profiles
by chaining multiple of these parameters. For example:</p>
<pre><code>goat -P live -P lowprevileges test.goat
</code></pre>
<p>The values of the profiles are then merged in order of given parameters.</p>
<p>The <code>default</code> profile is <strong>always</strong> loaded into the parameters if present. There you can define parameters that you always
want to use when executing goat. Other passed profiles and parameters will overwrite values in the default profile as usual.</p>
<p>Parameters passed via environment variables or via the <code>--parameter</code> flag will also overwrite profile values.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="how-does-it-work"><a class="header" href="#how-does-it-work">How does it work?</a></h1>
<p>In the following sections you will learn more about how the internals of Goat work. This will help you to understand how to create Goatfiles fitting your testing situation and work with them.</p>
<ul>
<li><a href="explanations/./state.html">State Management</a></li>
<li><a href="explanations/./lifecycle.html">Lifecycle</a></li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="state-management"><a class="header" href="#state-management">State Management</a></h1>
<p>Goat initializes a state for every Goatfile execution. A state initially consists of the parameters which were passed via a configuration file, environment variables, or the <code>--args</code> CLI parameter.</p>
<p>This state is then passed to every request in the executed Goatfile. The request can read and alter the state.
When one request has finished, the state is passed on to the next request and so on until the execution has finished.</p>
<p>Below, you can see a very simple example of what a state lifecycle could look like.</p>
<p><img src="explanations/../assets/simple-state.excalidraw.svg" alt="" /></p>
<h2 id="state-with-use"><a class="header" href="#state-with-use">State with <a href="explanations/../goatfile/import-statement.html"><code>use</code></a></a></h2>
<p>Because <a href="explanations/../goatfile/import-statement.html"><code>use</code></a> effectively merges the imported Goatfile together with the root Goatfile to a single batch execution, the state is shared between them. So if you define a variable in a Goatfile imported via <a href="explanations/../goatfile/import-statement.html"><code>use</code></a>, the variable will be accessible in subsequent imported Goatfiles as well as in the root Goatfile.</p>
<h2 id="state-with-execute"><a class="header" href="#state-with-execute">State with <a href="explanations/../goatfile/execute-statement.html"><code>execute</code></a></a></h2>
<p>Invoking another Goatfile via the <a href="explanations/../goatfile/execute-statement.html"><code>execute</code></a> command will make Goat handle the executed Goatfile like a separate batch with its own, disconnected state.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="lifecycle"><a class="header" href="#lifecycle">Lifecycle</a></h1>
<p>In this section, you will learn the basics on how exactly batches and requests are executed and when which section of a batch or test is evaluated.</p>
<h2 id="sections"><a class="header" href="#sections">Sections</a></h2>
<p>First of all, a batch consists of four logical sections.</p>
<ul>
<li>
<p><strong><code>Default</code></strong>: Contains default request parameters which are passed on to each executed request in the batch. This is the only section which does not actually execute actions and supports partial request fields.</p>
</li>
<li>
<p><strong><code>Setup</code></strong>: Contains actions which should be executed before the actual test steps are ran.</p>
</li>
<li>
<p><strong><code>Tests</code></strong>: The actual test actions.</p>
</li>
<li>
<p><strong><code>Teardown</code></strong>: Steps that are run after the test executions, e.g., to clean up stuff from the <code>Setup</code> and <code>Test</code> sections.</p>
</li>
</ul>
<h2 id="batch-lifecycle"><a class="header" href="#batch-lifecycle">Batch Lifecycle</a></h2>
<p>Below, you can find a simplified schematic of how a single test batch is executed.</p>
<pre class="mermaid">%%{init: {'theme':'dark'}}%%
flowchart TD
  collect_args[Collect params\nand arguments]
  entry[Parse entry Goatfile]
  resolve_imports[Resolve imports]
  parse_imports[Parse imports]
  merge_files[Merge files]
  create_state[Create state]
  setup_actions[Execute setup actions]
  setup_failed{Failed?}
  teardown_actions[Execute Teardown actions]
  test_actions[Execute Test actions]
  test_failed{Failed?}

  entry
    --&gt; resolve_imports
    --&gt; parse_imports -.-&gt; entry
  
  parse_imports
    --&gt; merge_files
    --&gt; setup_actions

  collect_args 
    ----&gt; create_state
    --&gt; setup_actions
    --&gt; setup_failed -- yes --&gt; teardown_actions
        setup_failed -- no --&gt; test_actions
          --&gt; test_failed -- yes --&gt; teardown_actions
              test_failed -- no --&gt; teardown_actions
</pre>
<p>Every batch begins with a single entrypoint Goatfile <em>(if you execute Goat on a folder of Goatfiles, each Goatfile in that folder will be seen as an entrypoint Goatfile and the batch execution will be executed indiviually for each file)</em>.</p>
<p>First, all imported <em>(see <a href="explanations/../goatfile/import-statement.html"><code>use</code></a>)</em> Goatfiles are resolved, parsed and merged together with the entrypoint Goatfile to one single batch execution. So all <code>Default</code>, <code>Setup</code>, <code>Test</code> and <code>Teardown</code> entries are merged together for each file.</p>
<p>"Simultaneously", all parameters are collected from passed parameter files, environment variables and arguments <em>(see <a href="explanations/../command-line-tool/index.html#flags">Command Line Tool</a>)</em>. These form the initial state.</p>
<p>After that, all <code>Setup</code> actions are executed. If any setup action has failed, the rest of the setup and the entire <code>Test</code> section is skipped. Finally, all teardown steps are executed and the batch exits in a failed state summarizing all errors that occurred.</p>
<p>If the <code>Setup</code> has completed successfully, the <code>Test</code> section is executed. Just as in the <code>Setup</code> section, if any of the <code>Test</code> actions fails, the entire section is skipped, the teardown actions are executed and the batch exits in a failed state.</p>
<p>If the <code>Test</code> section has completed successfully, the <code>Teardown</code> section is executed. Here, if any action fails, the execution <strong>continues</strong> instead of skipping the rest of the actions to ensure a complete cleanup as intended. If any of the <code>Teardown</code> actions fail, the batch execution will result in a failed state as well.</p>
<h2 id="action-lifecycle"><a class="header" href="#action-lifecycle">Action Lifecycle</a></h2>
<p>Below, you can see a simplified lifecycle diagram of the three actions <code>Request</code>, <code>Execute</code> and <code>Log Section</code>.</p>
<pre class="mermaid">%%{init: {'theme':'dark'}}%%
flowchart TD
  type{Type of Action}

  exit_with_failure(End with Failure)
  exit_with_success(End with Success)

  %% --- Request Type -----------------------------------------------

  apply_defaults[Apply defaults]
  pre_substitute[Substitute parameters\nfrom state]
  run_prescript[Run PreScript]
  prescript_success{Successful?}
  substitute[Re-substitute parameters\nfrom state]
  apply_options[Apply request options]
  condition_option{Condition option\nmatches?}
  run_request[Run Request]
  run_script[Run Script]
  script_success{Successful?}

  type 
    -- Request --&gt; apply_defaults
    --&gt; pre_substitute
    --&gt; run_prescript
    --&gt; prescript_success -- no --&gt; exit_with_failure
  
  prescript_success 
    -- yes --&gt; substitute
    --&gt; apply_options
  
  condition_option
    -- yes --&gt; run_request
    --&gt; run_script
    --&gt; script_success -- no --&gt; exit_with_failure

  script_success -- yes --&gt; exit_with_success

  apply_options --&gt; condition_option -- no --&gt; exit_with_success

  %% --- Execute Type -----------------------------------------------

  create_state_from_params[Create state from\npassed parameters]
  parse_goatfile[Parse Goatfile]
  execute_goatfile[Execute Goatfile]
  execute_success{Successful?}
  apply_captured[Apply captured\nreturn Values]

  type
    -- Execute --&gt; create_state_from_params
    --&gt; parse_goatfile
    --&gt; execute_goatfile
    --&gt; execute_success -- no --&gt; exit_with_failure

  execute_success
    -- yes --&gt; apply_captured
    -------&gt; exit_with_success
    
  %% --- Log Section Type -----------------------------------------------

  print_logsection[Print Section to Log]

  type
    -- Log Section --&gt; print_logsection 
    -----------&gt; exit_with_success
</pre>
<h3 id="request"><a class="header" href="#request">Request</a></h3>
<p>A <code>Request</code> action begins with the application of all default parameters from the <code>Default</code> section of the batch. After that, the parameters from the current state are substituted for the template parameters in the request definition. With the resulting state, the <code>PreScript</code> section is executed. If the execution failed, the request ends with a failure state. Otherwise, the new state is extracted and all templates are re-substituted using the new state. Following this, the request options are evaluated and applied. If the option <code>condition</code> evaluates to <code>false</code>, the request is skipped which ends the request in a success state. Otherwise, the actual request is now executed. Finally, the <code>Script</code> section is executed using the current state. Depending on the result, the request will end with a failure or success state.</p>
<h3 id="execute"><a class="header" href="#execute">Execute</a></h3>
<p>An <code>Execute</code> action "calls" another Goatfile with specified parameters and capture values. The defined parameters are used to initialize a new state. After that, the referenced Goatfile is parsed and executed with this new state. This execution is a whole new <a href="explanations/lifecycle.html#batch-lifecycle">Batch</a> execution in itself.</p>
<p>If this batch execution fails, the action results in a failed state as well. If it is successful, the defined values to be captured in the <code>return</code> statement are merged with the current state of the executing batch.</p>
<h3 id="log-section"><a class="header" href="#log-section">Log Section</a></h3>
<p>A <code>Log Section</code> is simply an action that prints a visual separator as <code>INFO</code> entry into the log to visually separate between test sections. This should never result in a failed action state.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="goatfile"><a class="header" href="#goatfile">Goatfile</a></h1>
<p>A Goatfile contains the request definitions for a Goat test suite. Goatfiles are written in plain
UTF-8 encoded text using the Goatfile syntax.</p>
<p>Goatfiles have the file extension <code>.goat</code>.</p>
<p>Below, you can see a really simple example Goatfile.</p>
<pre><code>### Tests

GET https://api.github.com/repos/{{.repo}}

[Script]
assert(response.StatusCode === 200, `Invalid response code: ${response.StatusCode}`);
assert(response.Body.language === "Go");

---

GET https://api.github.com/repos/{{.repo}}/languages

[Script]
info('Languages:\n' + JSON.stringify(response.Body, null, 2));
assert(response.StatusCode === 200, `Invalid response code: ${response.StatusCode}`);
</code></pre>
<p>More conclusive examples can be found <a href="https://github.com/studio-b12/goat/tree/main/examples">here</a>.</p>
<h2 id="specification"><a class="header" href="#specification">Specification</a></h2>
<p>Below, you can see a simple synopsis of the different building blocks of a Goatfile.</p>
<pre><code>         Import  |  use ./setup.goat
                 |
        Comment  |  // This is a comment!
                 |
Section Heading  |  ### Setup
                 |
Context Section  |  ##### Upload Tests
                 |
   Method &amp; URL  |  POST https://example.com
                 |  
        Headers  |  [Header]
                 |  X-Requested-With: XMLHttpRequest
                 |  Content-Type: application/json
                 |  Hash: {{ sha256 .data }}
                 |
           Body  |  [Body]
                 |  ```
                 |  {
                 |    "hello": "world",
                 |    "hash": "{{ sha256 .data }}",
                 |    "dontescapethis": "\{\{ \}\}"
                 |  }
                 |  ```
                 |
  Option Blocks  |  [QueryParams]
                 |  page = 2
                 |  items = 30
                 |  filters = ["time", "name"]
                 |
                 |  [MultipartFormdata]
                 |  image = @myimage.jpeg
                 |
                 |  [Options]
                 |  cookiejar = "foo"
                 |  storecookies = false
                 |
         Script  |  [Script]
                 |  assert(response.status &gt;= 200 &amp;&amp; response.status &lt; 400);
                 |  assert(response.body["name"] == "somename");
                 |
                 |  // capture a variable to be used in subsequent responses
                 |  var id = response.body["id"];
                 |
        Request  |  ---
      Separator  |
                 |
        Execute  |  execute ./testFileUpload (
                 |    file="file_a.txt"
                 |    token="{{.auth.token}}"
                 |  ) return (
                 |    fileId as fileId_a
                 |  )
</code></pre>
<p>In the following sections, you will find a detailed rundown for each component of a Goatfile.</p>
<ul>
<li><a href="goatfile/./comments.html">Comment</a></li>
<li><a href="goatfile/./import-statement.html">Import Statement</a></li>
<li><a href="goatfile/./execute-statement.html">Execute Statement</a></li>
<li><a href="goatfile/./sections.html">Section</a></li>
<li><a href="goatfile/./defaults-section.html">Defaults Section</a></li>
<li><a href="goatfile/./logsections.html">Log Section</a></li>
<li><a href="goatfile/./requests/index.html">Request</a>
<ul>
<li><a href="goatfile/./requests/method-and-url.html">Method and URL</a></li>
<li><a href="goatfile/./requests/options.html">Options</a></li>
<li><a href="goatfile/./requests/header.html">Headers</a></li>
<li><a href="goatfile/./requests/query-params.html">Query Parameters</a></li>
<li><a href="goatfile/./requests/body.html">Body</a></li>
<li><a href="goatfile/./requests/prescript.html">PreScript</a></li>
<li><a href="goatfile/./requests/script.html">Script</a></li>
</ul>
</li>
</ul>
<div style="break-before: page; page-break-before: always;"></div><h1 id="comment"><a class="header" href="#comment">Comment</a></h1>
<h2 id="syntax"><a class="header" href="#syntax">Syntax</a></h2>
<blockquote>
<p><em>CommentDefinition</em> :<br />
<em>LineComment</em> | <em>BlockComment</em></p>
<p><em>LineComment</em> :<br />
<code>//</code> .* <code>NL</code></p>
<p><em>BlockComment</em> :<br />
<code>/*</code> .* <code>*/</code></p>
</blockquote>
<h2 id="example"><a class="header" href="#example">Example</a></h2>
<pre><code>// This is a line comment!

/// This is a line comment as well!

/*
  This is a
    multiline
  block comment!
*/
</code></pre>
<h2 id="explanation"><a class="header" href="#explanation">Explanation</a></h2>
<p>Contents of comments are ignored by the parser.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="import-statement"><a class="header" href="#import-statement">Import Statement</a></h1>
<h3 id="syntax-1"><a class="header" href="#syntax-1">Syntax</a></h3>
<blockquote>
<p><em>UseExpression</em> :<br />
<code>use</code> <em>StringLiteral</em></p>
</blockquote>
<h3 id="example-1"><a class="header" href="#example-1">Example</a></h3>
<pre><code>use ../path/to/goatfile
</code></pre>
<h3 id="explanation-1"><a class="header" href="#explanation-1">Explanation</a></h3>
<p>External Goatfiles can be imported using the <code>use</code> statement.</p>
<p>Imported Goatfiles behave like they are merged with the root Goatfile. So when you import a Goatfile <code>B</code> into a Goatfile <code>A</code>, all actions in all sections of <code>B</code> will be inserted <strong>in front</strong> of the actions in the sections of <code>A</code>. Meanwhile, the order of the sections <code>Setup</code>, <code>Tests</code> and <code>Teardown</code> stays intact.</p>
<p>Cyclical or repeated imports are not allowed.</p>
<p>Schematic Example:</p>
<p><code>A.goat</code></p>
<pre><code>use B

### Setup

GET A1

### Tests

GET A2

### Teardown

GET A3
</code></pre>
<p><code>B.goat</code></p>
<pre><code>### Setup

GET B1

### Tests

GET B2

### Teardown

GET B3
</code></pre>
<p><em>Result (virtual):</em></p>
<pre><code>### Setup

GET B1
GET A1

### Tests

GET B2
GET A2

### Teardown

GET B3
GET A3
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="execute-statement"><a class="header" href="#execute-statement">Execute Statement</a></h1>
<h3 id="syntax-2"><a class="header" href="#syntax-2">Syntax</a></h3>
<blockquote>
<p><em>ExecuteExpression</em> :<br />
<code>execute</code> <em>StringLiteral</em></p>
<p><em>Parameters</em> :<br />
<code>(</code> (<em>KeyValuePair</em> (<code>WS</code>|<code>NL</code>)+ )* <code>)</code> <em>ReturnStatement</em>?</p>
<p><em>ReturnStatement</em> :<br />
<code>(</code> (<em>ReturnPair</em> (<code>WS</code>|<code>NL</code>)+ )* <code>)</code></p>
<p><em>ReturnPair</em> :<br />
<em>StringLiteral</em> <code>as</code> <em>StringLiteral</em></p>
<p><em>KeyValuePair</em> :<br />
<em>StringLiteral</em> <code>WS</code>* <code>=</code> <code>WS</code>* <em>StringLiteral</em></p>
</blockquote>
<h3 id="example-2"><a class="header" href="#example-2">Example</a></h3>
<pre><code>execute "../utils/login" (
  username="{{.credentials.username}}"
  password="{{.credentials.password}}"
) return (
  userId as userId
)
</code></pre>
<h3 id="explanation-2"><a class="header" href="#explanation-2">Explanation</a></h3>
<p>The <code>execute</code> statement allows to run an external Goatfile inside another Goatfile <strong>in its own state context</strong>. Parameters for the executed Goatfile can be passed and values in the resulting state can be taken over into the calling Goatfile's state.</p>
<p>In contrast to the <code>use</code> directive, the executed Goatfile <code>A</code> is run like a completely separate Goatfile execution with its own isolated state which does not share any values with the state of the executing file <code>B</code>. All parameters which shall be available in <code>A</code> must be passed as a list of key-value pairs. Resulting state values of <code>A</code> can then be captured by the state of <code>B</code> by listing them in the <code>return</code> statement with the name of the parameter in the state of <code>A</code> and the name the value shall be accessible under in <code>B</code>.</p>
<p>Executed Goatfiles are parsed in place, so they are only statically checked once they are executed within the executing Goatfile.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="section"><a class="header" href="#section">Section</a></h1>
<h2 id="syntax-3"><a class="header" href="#syntax-3">Syntax</a></h2>
<blockquote>
<p><em>SectionDefinition</em> :<br />
<em>SectionHeader</em> <code>NL</code>+ <em>SectionContent</em></p>
<p><em>SectionHeader</em> :<br />
<code>###</code> <em>StringLiteral</em></p>
</blockquote>
<h2 id="example-3"><a class="header" href="#example-3">Example</a></h2>
<pre><code>### Tests

// ...
</code></pre>
<h2 id="explanation-3"><a class="header" href="#explanation-3">Explanation</a></h2>
<p>A section defines a discrete segment in a Goatfile. This can either be a specialized section like the <code>Defaults</code> section or a request section like <code>Setup</code>, <code>Tests</code> and <code>Teardown</code>. More information on these section types can be found under <a href="goatfile/../explanations/lifecycle.html">Lifecycle</a>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="defaults-section"><a class="header" href="#defaults-section">Defaults Section</a></h1>
<h2 id="syntax-4"><a class="header" href="#syntax-4">Syntax</a></h2>
<blockquote>
<p><em>DefaultsBlock</em> :<br />
<code>###</code> <code>defaults</code> <code>NL</code>+ <em>PartialRequestProperties</em>?</p>
</blockquote>
<h2 id="example-4"><a class="header" href="#example-4">Example</a></h2>
<pre><code>### Defaults

[Options]
storecookies = false

[Header]
Authorization: basic {{.token}}

[Script]
assert(response.StatusCode === 200);
</code></pre>
<h2 id="explanation-4"><a class="header" href="#explanation-4">Explanation</a></h2>
<p>The <code>Defaults</code> section body is structured like a <a href="goatfile/requests/index.html">request</a> but without the method and URL section. This includes the blocks <code>[Options]</code>, <code>[Header]</code>, <code>[QueryParams]</code>, <code>[Body]</code>, <code>[PreScript]</code> and <code>[Script]</code>.</p>
<p>Values specified in <code>[Header]</code>, <code>[Options]</code> and <code>[QueryParams]</code> will be merged with the values set in each request. Values set in a request will overwrite values set in the defaults, if specified in both.</p>
<p>On the other hand, values specified in <code>[Body]</code>, <code>[PreScript]</code> or <code>[Script]</code> will be used if not specified in the requests. If these blocks are specified in the request, they will overwrite the default values as well (even if they are empty).</p>
<p>Default values will also be applied if imported via a <code>use</code> directive. Multiple <code>Defaults</code> sections will be merged together in order of specification.</p>
<h3 id="merge-example"><a class="header" href="#merge-example">Merge Example</a></h3>
<p>Here is a quick example on how the merges will result.</p>
<p>Let's assume the following defaults are set.</p>
<pre><code>### Defaults

[Header]
Content-Type: application/json
Accept-Language: de;q=0.8, en

[Options]
storecookies = false

[Script]
assert(response.Status === 200);
</code></pre>
<p>Our first request definition looks like this:</p>
<pre><code>GET {{.instance}}/api/v1/users/me

[Header]
Authorization: bearer sDrYbXdm2tCYnb8p
</code></pre>
<p>The resulting <strong>merged</strong> request fields will look as following.</p>
<pre><code>GET {{.instance}}/api/v1/users/me

[Header]
Content-Type: application/json
Accept-Language: de;q=0.8, en
Authorization: bearer sDrYbXdm2tCYnb8p

[Options]
storecookies = false

[Script]
assert(response.Status === 200);
</code></pre>
<p>The second request looks like this.</p>
<pre><code>POST {{.instance}}/api/v1/login

[Header]
Content-Type: multipart/form-data; boundary=bbecc22460604a4d97e62895cc6b254a

[Options]
storecookies = true

[Body]
```
--bbecc22460604a4d97e62895cc6b254a
Content-Disposition: form-data; name="username"

foo
--bbecc22460604a4d97e62895cc6b254a
Content-Disposition: form-data; name="password"

bar
--bbecc22460604a4d97e62895cc6b254a--
```

[Script]
assert(response.Status === 200);
assert(response.Body === expectedUserId);
</code></pre>
<p>And the resulting <strong>merged</strong> parameters will look as following.</p>
<pre><code>POST {{.instance}}/api/v1/login

[Header]
Accept-Language: de;q=0.8, en
Content-Type: multipart/form-data; boundary=bbecc22460604a4d97e62895cc6b254a

[Options]
storecookies = true

[Body]
```
--bbecc22460604a4d97e62895cc6b254a
Content-Disposition: form-data; name="username"

foo
--bbecc22460604a4d97e62895cc6b254a
Content-Disposition: form-data; name="password"

bar
--bbecc22460604a4d97e62895cc6b254a--
```

[Script]
assert(response.Status === 200);
assert(response.Body === expectedUserId);
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="log-section-1"><a class="header" href="#log-section-1">Log Section</a></h1>
<h2 id="syntax-5"><a class="header" href="#syntax-5">Syntax</a></h2>
<blockquote>
<p><em>LogSectionDefinition</em> :<br />
<code>#####</code> <em>Text</em> <code>NL</code></p>
</blockquote>
<h2 id="example-5"><a class="header" href="#example-5">Example</a></h2>
<pre><code>##### User Authentication Tests

// ...
</code></pre>
<h2 id="explanation-5"><a class="header" href="#explanation-5">Explanation</a></h2>
<p>A log section will produce a log output containing the given text to provide a visual separation between requests.</p>
<p>These sections can be used everywhere where requests can be specified as well.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="request-1"><a class="header" href="#request-1">Request</a></h1>
<h2 id="syntax-6"><a class="header" href="#syntax-6">Syntax</a></h2>
<blockquote>
<p><em>RequestDefinition</em> :<br />
<em>RequestHeader</em> <code>NL</code> (<em>RequestBlock</em> <code>NL</code>)* <em>RequestDelimiter</em> <code>NL</code></p>
<p><em>RequestHeader</em> :<br />
<em>StringLiteral</em> <code>WS</code>+ <em>StringLiteral</em></p>
<p><em>RequestBlock</em> :<br />
<em>RequestBlockHeader</em> <code>NL</code> <em>RequestBlockContent</em></p>
<p><em>RequestDelimiter</em> :<br />
<code>---</code> <code>-</code>*</p>
</blockquote>
<h2 id="example-6"><a class="header" href="#example-6">Example</a></h2>
<pre><code>GET https://example.com/api/users

[Header]
Accept: application/json
Authentication: basic {{ .credentials.token }}

[Script]
assert(response.StatusCode === 200);

---
</code></pre>
<h2 id="explanation-6"><a class="header" href="#explanation-6">Explanation</a></h2>
<p>Define a request to be executed. The request definition starts with the request header consisting of the method followed by the URI (separated by one or more spaces). The request header is the only mandatory field for a valid request definition.</p>
<p>After that, you can specify more details about the request in different blocks. In the following documentation sections, all available blocks are listed and explained.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="method-and-url"><a class="header" href="#method-and-url">Method and URL</a></h1>
<h2 id="syntax-7"><a class="header" href="#syntax-7">Syntax</a></h2>
<blockquote>
<p><em>RequestHeader</em> :<br />
<em>StringLiteral</em> <code>WS</code>+ <em>StringLiteral</em></p>
</blockquote>
<h2 id="example-7"><a class="header" href="#example-7">Example</a></h2>
<pre><code>GET https://example.com/api/users
</code></pre>
<h2 id="explanation-7"><a class="header" href="#explanation-7">Explanation</a></h2>
<p>The request header defines the method and URL for a request and is the only mandatory element
to define a request.</p>
<p>The method can be any uppercase string.</p>
<p>The URL can either be defined as an unquoted string literal or as a quoted string if spaces are required in the URL. Template substitution is supported.</p>
<p>✅ Valid</p>
<pre><code>GET https://example.com/api/users
</code></pre>
<p>✅ Valid</p>
<pre><code>GET https://example.com/api/users/{{.userId}}
</code></pre>
<p>✅ Valid</p>
<pre><code>GET "https://example.com/api/users/some user"
</code></pre>
<p>✅ Valid</p>
<pre><code>GET "https://example.com/api/users/{{ .userId }}"
</code></pre>
<p>❌ Invalid</p>
<pre><code>GET https://example.com/api/users/{{ .userId }}
</code></pre>
<p>❌ Invalid</p>
<pre><code>GET https://example.com/api/users/some user
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="options"><a class="header" href="#options">Options</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Options]</code> <code>NL</code>+ <em>RequestOptionsContent</em></p>
<p><em>RequestOptionsContent</em> :<br />
<em>TomlKeyValues</em></p>
</blockquote>
<h2 id="example-8"><a class="header" href="#example-8">Example</a></h2>
<pre><code class="language-toml">[Options]
cookiejar = "admin"
condition = {{ isset . "userId" }}
delay = "5s"
</code></pre>
<h2 id="explanation-8"><a class="header" href="#explanation-8">Explanation</a></h2>
<p>Define additional options to the requests. The format of the contents of this block is <a href="https://toml.io/"><code>TOML</code></a>.</p>
<p>The option values support template substitution.</p>
<p>Below, all available options are explained.</p>
<h3 id="cookiejar"><a class="header" href="#cookiejar"><code>cookiejar</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>string</code> | <code>number</code></li>
<li><strong>Default</strong>: <code>"default"</code></li>
</ul>
<p>Defines the cookie jar to be used for saving and storing cookies. A cookie jar can be specified by either a number or a string. Every cookie jar contains a separate set of cookies collected from requests performed with that cookie jar specified.</p>
<h3 id="storecookies"><a class="header" href="#storecookies"><code>storecookies</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>true</code></li>
</ul>
<p>Defines if a cookie set by a request's response shall be stored in the cookie jar.</p>
<h3 id="sendcookies"><a class="header" href="#sendcookies"><code>sendcookies</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>true</code></li>
</ul>
<p>Defines if cookies stored in the specified cookie jar shall be sent to the server on request.</p>
<h3 id="noabort"><a class="header" href="#noabort"><code>noabort</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>false</code></li>
</ul>
<p>When enabled, a batch execution will not be canceled when the request execution or assertion failed.</p>
<h3 id="alwaysabort"><a class="header" href="#alwaysabort"><code>alwaysabort</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>false</code></li>
</ul>
<p>Forces a batch request to abort if the request execution or assertion failed, even if the <code>--no-abort</code> CLI flag has been passed.</p>
<h3 id="condition"><a class="header" href="#condition"><code>condition</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>boolean</code></li>
<li><strong>Default</strong>: <code>true</code></li>
</ul>
<p>Defines if a request shall be executed or not. This is useful in combination with template substitution.</p>
<blockquote>
<p>For example, the following request will only be executed when <code>localAddress</code> is set in the current state.</p>
<pre><code>[Options]
condition = {{ isset . "localAddress" }}
</code></pre>
</blockquote>
<h3 id="delay"><a class="header" href="#delay"><code>delay</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: <code>0</code></li>
</ul>
<p>A duration formatted as a Go <a href="https://pkg.go.dev/time#ParseDuration">time.ParseDuration</a> compatible string. Execution will pause for this duration before the request is executed.</p>
<h3 id="responsetype"><a class="header" href="#responsetype"><code>responsetype</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>string</code></li>
<li><strong>Default</strong>: <code>""</code></li>
</ul>
<p>Explicit type declaration for body parsing. Implicit body parsing (json/xml) can be prevented by setting this option to <code>raw</code>.</p>
<h3 id="followredirects"><a class="header" href="#followredirects"><code>followredirects</code></a></h3>
<ul>
<li><strong>Type</strong>: <code>bool</code></li>
<li><strong>Default</strong>: <code>true</code></li>
</ul>
<p>Define whether or not to follow redirect responses on <code>GET</code> requests.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="header"><a class="header" href="#header">Header</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Header]</code> <code>NL</code>+ <em>RequestHeaderContent</em></p>
<p><em>RequestHeaderContent</em> :<br />
<em>HeaderKV</em>*</p>
<p><em>HeaderKV</em> :<br />
<code>/[A-Za-z\-]+/</code> <code>:</code> <code>WS</code>* <code>/.*/</code> <code>NL</code></p>
</blockquote>
<h2 id="example-9"><a class="header" href="#example-9">Example</a></h2>
<pre><code class="language-toml">[Header]
Content-Type: application/json
Accept: application/json
X-Some-Custom-Header: foo bar bazz
</code></pre>
<h2 id="explanation-9"><a class="header" href="#explanation-9">Explanation</a></h2>
<p>Define HTTP headers sent with the request in <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/Messages#headers">HTTP conform header representation</a>.</p>
<p>Template parameters in the headers' value fields will be substituted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="queryparams"><a class="header" href="#queryparams">QueryParams</a></h1>
<blockquote>
<p><em>QueryParams</em> :<br />
<code>[QueryParams]</code> <code>NL</code>+ <em>QueryParamsContent</em></p>
<p><em>QueryParamsContent</em> :<br />
<em>TomlKeyValues</em></p>
</blockquote>
<h2 id="example-10"><a class="header" href="#example-10">Example</a></h2>
<pre><code class="language-toml">[QueryParams]
page = {{.page}}
count = 100
field = ["username", "age", "id"]
token = "{{.apitoken}}"
</code></pre>
<h2 id="explanation-10"><a class="header" href="#explanation-10">Explanation</a></h2>
<p>Define additional query parameters which will be appended to the request URL. The format of the contents of this block is <a href="https://toml.io/"><code>TOML</code></a>.</p>
<p>An array of values will be represented as a repetition of the same query parameter with the different contained values assigned.</p>
<blockquote>
<p>The example from above results in the following query parameters.</p>
<pre><code>page=5&amp;count=100&amp;field=username&amp;field=age&amp;field=id
</code></pre>
</blockquote>
<p>Template parameters in parameter values will be substituted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="auth"><a class="header" href="#auth">Auth</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Auth]</code> <code>NL</code>+ <em>RequestAuthContent</em></p>
<p><em>RequestAuthContent</em> :<br />
<em>TomlKeyValues</em></p>
</blockquote>
<h2 id="example-11"><a class="header" href="#example-11">Example</a></h2>
<pre><code class="language-toml">[Auth]
username = "foo"
password = "{{.credentials.password}}"
</code></pre>
<h2 id="explanation-11"><a class="header" href="#explanation-11">Explanation</a></h2>
<p>Auth is a utility block for easily defining basic or token authorization. When defined, the <code>Authorization</code> header will
be set accordingly to the request.</p>
<h2 id="basic-auth"><a class="header" href="#basic-auth">Basic Auth</a></h2>
<p>If you want to add basic auth to your request, simply define a <code>username</code> and <code>password</code>. If <strong>both</strong> values are set,
the username and password are joined by a <code>:</code> and encoded using end-padded base64. The encoded value is then set to the
<code>Authorization</code> header using the <code>basic</code> auth type (as defined in
<a href="https://www.rfc-editor.org/rfc/rfc7617">RFC 7671</a>).</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-toml">[Auth]
username = "foo"
password = "bar"
</code></pre>
<p>his input will result in the following header.</p>
<pre><code>Authorization: basic Zm9vOmJhcg==
</code></pre>
</blockquote>
<h2 id="token-auth"><a class="header" href="#token-auth">Token Auth</a></h2>
<p>You can also specify a <code>token</code> set as <code>Authorization</code> header. If defined, the token will be prefixed with
a token <code>type</code>.</p>
<blockquote>
<p><strong>Example</strong></p>
<pre><code class="language-toml">[Auth]
type = "bearer"
token = "foobarbaz"
</code></pre>
<p>This input will result in the following header.</p>
<pre><code>Authorization: bearer foobarbaz
</code></pre>
<pre><code class="language-toml">[Auth]
token = "foobarbaz"
</code></pre>
<p>This input will result in the following header.</p>
<pre><code>Authorization: foobarbaz
</code></pre>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="body"><a class="header" href="#body">Body</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Body]</code> <code>NL</code>+ <em>RequestBodyContent</em></p>
<p><em>RequestBodyContent</em> :<br />
<em>BlockDelimitedContent</em> | <em>UndelimitedContent</em></p>
<p><em>BlockDelimitedContent</em> :<br />
<em>BlockDelimiter</em> <code>NL</code> <code>/.*/</code> <code>NL</code> <em>BlockDelimiter</em></p>
<p><em>UndelimitedContent</em> :<br />
(<code>/.*/</code> <code>NL</code>)* <code>NL</code></p>
<p><em>BlockDelimiter</em> :<br />
<code>```</code></p>
</blockquote>
<h2 id="example-12"><a class="header" href="#example-12">Example</a></h2>
<pre><code class="language-toml">[Body]
```
{
  "user": {
    "name": "{{.userName}}",
    "favorite_programming_langs": [
      "Go",
      "Rust"
    ],
  }
}
```
</code></pre>
<h2 id="explanation-12"><a class="header" href="#explanation-12">Explanation</a></h2>
<p>Define the data to be transmitted with the request.</p>
<p>If you want to use the template parameter braces (<code>{{</code>, <code>}}</code>) without substitution, you can escape them using a backslash.</p>
<p>Example:</p>
<pre><code class="language-toml">[Body]
```
{
  "user": {
    "name": "\{\{This will not be substituted\}\}",
    "favorite_programming_langs": [
      "Go",
      "Rust"
    ],
  }
}
```
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="formdata"><a class="header" href="#formdata">FormData</a></h1>
<blockquote>
<p><em>FormData</em> :<br />
<code>[FormData]</code> <code>NL</code>+ <em>FormDataContent</em></p>
<p><em>FormDataContent</em> :<br />
<em>TomlKeyValues</em></p>
</blockquote>
<h2 id="example-13"><a class="header" href="#example-13">Example</a></h2>
<pre><code class="language-toml">[FormData]
someString = "some string"
someInt = 42
someFile = @files/goat.png:image/png
</code></pre>
<h2 id="explanation-13"><a class="header" href="#explanation-13">Explanation</a></h2>
<p>Defines entries in a key-value pair format which will be sent in the request body as <code>multipart/form-data</code> request.
The format of the contents of this block is <a href="https://toml.io/"><code>TOML</code></a>.</p>
<p>The file's content type can be specified after the file descriptor, separated by a colon (<code>:</code>). Otherwise,
the content type will default to <code>application/octet-stream</code>.</p>
<blockquote>
<p>The example from above results in the following body content.</p>
<pre><code>--e8b9253313450dbcf0d09df1a0f3ff36dd00e888339415a239ce167f279c
Content-Disposition: form-data; name="someInt"

42
--e8b9253313450dbcf0d09df1a0f3ff36dd00e888339415a239ce167f279c
Content-Disposition: form-data; name="someFile"; filename="goat.png"
Content-Type: image/png

&lt;binary file content&gt;
--e8b9253313450dbcf0d09df1a0f3ff36dd00e888339415a239ce167f279c
Content-Disposition: form-data; name="someString"

some string
--e8b9253313450dbcf0d09df1a0f3ff36dd00e888339415a239ce167f279c--
</code></pre>
</blockquote>
<p>Template parameters in parameter values will be substituted.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="prescript"><a class="header" href="#prescript">PreScript</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[PreScript]</code> <code>NL</code>+ <em>RequestPreScriptContent</em></p>
<p><em>RequestPreScriptContent</em> :<br />
<em>BlockDelimitedContent</em> | <em>UndelimitedContent</em></p>
<p><em>BlockDelimitedContent</em> :<br />
<em>BlockDelimiter</em> <code>NL</code> <code>/.*/</code> <code>NL</code> <em>BlockDelimiter</em></p>
<p><em>UndelimitedContent</em> :<br />
(<code>/.*/</code> <code>NL</code>)* <code>NL</code></p>
<p><em>BlockDelimiter</em> :<br />
<code>```</code></p>
</blockquote>
<h2 id="example-14"><a class="header" href="#example-14">Example</a></h2>
<pre><code class="language-toml">[PreScript]
```
var fileName = requestedFile.Metadata.Name;
```
</code></pre>
<h2 id="explanation-14"><a class="header" href="#explanation-14">Explanation</a></h2>
<p>A script section which is evaluated before the template parameters are substituted and the actual request is executed. This can be used to put values from previous responses into variables which can then be used in the request parameters.</p>
<p>Example:</p>
<pre><code>POST http://example.com/api/user

[Body]
// ...

[Script]
assert(response.StatusCode === 201);
var user = response.Body;

---

GET http://example.com/api/user/{{.userid}}

[PreScript]
var userid = user.id;
</code></pre>
<p><code>PreScript</code> will always be executed before template parameters in the request definition are substituted. This makes it possible to use the results in various fields like <code>[Options]</code>, <code>[Body]</code>, <code>[Header]</code> or <code>[Script]</code>.</p>
<p>Scripts are written in ES5.1 conform JavaScript. More on that can be found in the <a href="goatfile/requests/./script.html">Script</a> section documentation.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="script"><a class="header" href="#script">Script</a></h1>
<blockquote>
<p><em>RequestOptions</em> :<br />
<code>[Script]</code> <code>NL</code>+ <em>RequestScriptContent</em></p>
<p><em>RequestScriptContent</em> :<br />
<em>BlockDelimitedContent</em> | <em>UndelimitedContent</em></p>
<p><em>BlockDelimitedContent</em> :<br />
<em>BlockDelimiter</em> <code>NL</code> <code>/.*/</code> <code>NL</code> <em>BlockDelimiter</em></p>
<p><em>UndelimitedContent</em> :<br />
(<code>/.*/</code> <code>NL</code>)* <code>NL</code></p>
<p><em>BlockDelimiter</em> :<br />
<code>```</code></p>
</blockquote>
<h2 id="example-15"><a class="header" href="#example-15">Example</a></h2>
<pre><code class="language-toml">[Script]
```
assert(response.StatusCode === 200, `Response status code was ${response.StatusCode}`);
assert(response.Body.UserName === "Foo Bar");
```
</code></pre>
<h2 id="explanation-15"><a class="header" href="#explanation-15">Explanation</a></h2>
<p>A script section which is executed after a request has been performed and a response has been received. This is generally used to assert response values like status codes, header values or body content.</p>
<p>Scripts are written in ES5.1 conform JavaScript.</p>
<p>The context of the script always contains the current values in the batch state as global variables.</p>
<p>A special variable set in each <code>[Script]</code> section is the <code>response</code> variable, which contains all information about the request response. The <code>Response</code> object contains the following fields.</p>
<pre><code class="language-go">type Response struct {
	StatusCode    int
	Status        string
	Proto         string
	ProtoMajor    int
	ProtoMinor    int
	Header        map[string][]string
	ContentLength int64
	BodyRaw       []byte
	Body          any
}
</code></pre>
<p><code>Body</code> is a special field containing the response body content as a JavaScript object which will be populated if the response body can be parsed.
Parsers are currently implemented for <code>json</code> and <code>xml</code> and are chosen depending on the <code>responsetype</code> option or the <code>Content-Type</code> header.
If neither are set, the raw response string gets set as <code>Body</code>. By setting the <code>responsetype</code> to <code>raw</code>, implicit body parsing can be prevented.</p>
<p>In any script section, a number of built-in functions like <code>assert</code> can be used, which are documented <a href="goatfile/requests/../../scripting/builtins.html">here</a>.</p>
<p>If a script section throws an uncaught exception, the test will be evaluated as <em>failed</em>.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="templating"><a class="header" href="#templating">Templating</a></h1>
<p>One of the most powerful features of Goat is the ability to use variables from the state in almost every value field in a request definition.</p>
<p>These values are substituted using the powerful templating engine of Go. We will only go over the most basic syntax. Please review the <a href="https://pkg.go.dev/text/template">Go template documentation</a> for full details.</p>
<h2 id="syntax-8"><a class="header" href="#syntax-8">Syntax</a></h2>
<p>Template parameters in Goatfiles are defined inside double-braces (<code>{{ }}</code>). Variables from the state are referenced using a dot notation. Let's take a look at the following example.</p>
<p>We have the following state.</p>
<pre><code class="language-yml">instance: "http://example.com"

credentials:
  username: "foobar"
  password: "password"
</code></pre>
<p>Now, we can reference the values in our state as follows:</p>
<pre><code>POST {{.instance}}/api/v1/auth/login

[Body]
{
  "username": "{{.credentials.username}}"
  "password": "{{.credentials.password}}"
}
</code></pre>
<p>Functions can be called using the name of the function followed by the parameters separated by spaces. Lets take a look at an example.</p>
<p>We assume the following state:</p>
<pre><code class="language-yaml">name: "Max"
</code></pre>
<pre><code>{{ printf "Hello, %s!" .name }}
</code></pre>
<p>This will result in the string value <code>"Hello, Max!"</code>.</p>
<blockquote>
<p>As you can see, you can use the <a href="https://pkg.go.dev/text/template#hdr-Functions">built-in templating functions provided by Go</a>.<br />
There are also a lot of <a href="templating/./builtins.html">built-in functions provided by Goat</a> which you can use in your Goatfiles.</p>
</blockquote>
<div style="break-before: page; page-break-before: always;"></div><h1 id="built-ins"><a class="header" href="#built-ins">Built-ins</a></h1>
<p>The following built-in functions are available in templates used in Goatfiles.</p>
<ul>
<li><a href="templating/builtins.html#base64"><code>base64</code></a></li>
<li><a href="templating/builtins.html#base64Url"><code>base64Url</code></a></li>
<li><a href="templating/builtins.html#base64Unpadded"><code>base64Unpadded</code></a></li>
<li><a href="templating/builtins.html#base64UrlUnpadded"><code>base64UrlUnpadded</code></a></li>
<li><a href="templating/builtins.html#formatTimestamp"><code>formatTimestamp</code></a></li>
<li><a href="templating/builtins.html#md5"><code>md5</code></a></li>
<li><a href="templating/builtins.html#sha1"><code>sha1</code></a></li>
<li><a href="templating/builtins.html#sha256"><code>sha256</code></a></li>
<li><a href="templating/builtins.html#sha512"><code>sha512</code></a></li>
<li><a href="templating/builtins.html#randomString"><code>randomString</code></a></li>
<li><a href="templating/builtins.html#randomInt"><code>randomInt</code></a></li>
<li><a href="templating/builtins.html#timestamp"><code>timestamp</code></a></li>
<li><a href="templating/builtins.html#isset"><code>isset</code></a></li>
<li><a href="templating/builtins.html#json"><code>json</code></a></li>
</ul>
<h2 id="base64"><a class="header" href="#base64"><code>base64</code></a></h2>
<pre><code>base64 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the input <code>value</code> as base64 encoded string with padding.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ base64 "hello world" }}
</code></pre>
<h2 id="base64url"><a class="header" href="#base64url"><code>base64Url</code></a></h2>
<pre><code>base64Url &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the input <code>value</code> as base64url encoded string with padding.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ base64Url "hello world" }}
</code></pre>
<h2 id="base64unpadded"><a class="header" href="#base64unpadded"><code>base64Unpadded</code></a></h2>
<pre><code>base64Unpadded &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the input <code>value</code> as base64 encoded string without padding.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ base64Unpadded "hello world" }}
</code></pre>
<h2 id="base64urlunpadded"><a class="header" href="#base64urlunpadded"><code>base64UrlUnpadded</code></a></h2>
<pre><code>base64UrlUnpadded &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the input <code>value</code> as base64url encoded string without padding.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ base64UrlUnpadded "hello world" }}
</code></pre>
<h2 id="formattimestamp"><a class="header" href="#formattimestamp"><code>formatTimestamp</code></a></h2>
<pre><code>formatTimestamp &lt;value: Date&gt; &lt;format?: string&gt; -&gt; string
formatTimestamp &lt;value: string&gt; &lt;valueFormat: string&gt; &lt;format?: string&gt; -&gt; string
</code></pre>
<p>Takes either a <code>Date</code> object and an optional output format or a timestamp string, the format for the input timestamp and
an optional output format and returns the formatted timestamp.</p>
<p>The format is according to Go's <a href="https://pkg.go.dev/time#pkg-constants"><code>time</code> package definition</a>. You can also specify
the names of the predefined formats like <code>rfc3339</code> or <code>DateOnly</code>. If no format is passed, the time will be represented as
Unix seconds.</p>
<h2 id="md5"><a class="header" href="#md5"><code>md5</code></a></h2>
<pre><code>md5 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the HEX encoded MD5 hash of the given input <code>value</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ md5 "hello world" }}
</code></pre>
<h2 id="sha1"><a class="header" href="#sha1"><code>sha1</code></a></h2>
<pre><code>sha1 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the HEX encoded SHA1 hash of the given input <code>value</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ sha1 "hello world" }}
</code></pre>
<h2 id="sha256"><a class="header" href="#sha256"><code>sha256</code></a></h2>
<pre><code>sha256 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the HEX encoded SHA256 hash of the given input <code>value</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ sha256 "hello world" }}
</code></pre>
<h2 id="sha512"><a class="header" href="#sha512"><code>sha512</code></a></h2>
<pre><code>sha512 &lt;value: string&gt; -&gt; string
</code></pre>
<p>Returns the HEX encoded SHA512 hash of the given input <code>value</code>.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ sha512 "hello world" }}
</code></pre>
<h2 id="randomstring"><a class="header" href="#randomstring"><code>randomString</code></a></h2>
<pre><code>randomString &lt;length?: integer&gt; -&gt; string
</code></pre>
<p>Returns a random string with the given length. If no length is passed, the default length is 8 characters.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ randomString 16 }}
</code></pre>
<h2 id="randomint"><a class="header" href="#randomint"><code>randomInt</code></a></h2>
<pre><code>randomInt &lt;n?: integer&gt; -&gt; int
</code></pre>
<p>Returns a random integer in the range <code>[0, n)</code> where <code>n</code> is given as parameter. if no parameter is passed, <code>n</code> defaults to the max int value.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ randomInt 256 }}
</code></pre>
<h2 id="timestamp"><a class="header" href="#timestamp"><code>timestamp</code></a></h2>
<pre><code>timestamp &lt;format?: string&gt; -&gt; string
</code></pre>
<p>Returns the current timestamp in the given format.</p>
<p>The format is according to Go's <a href="https://pkg.go.dev/time#pkg-constants"><code>time</code> package definition</a>. You can also specify
the names of the predefined formats like <code>rfc3339</code> or <code>DateOnly</code>. If no format is passed, the time will be represented as
Unix seconds.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ timestamp "Mon, 02 Jan 2006 15:04:05 MST" }}
</code></pre>
<h2 id="isset"><a class="header" href="#isset"><code>isset</code></a></h2>
<pre><code>isset &lt;map: map[string]any&gt; &lt;key: string&gt; -&gt; bool
</code></pre>
<p>Returns <code>true</code> when the given <code>key</code> is present and its corresponding value is not <code>nil</code> in the given <code>map</code>. Otherwise, <code>false</code> is returned.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ isset . "username" }}
</code></pre>
<h2 id="json"><a class="header" href="#json"><code>json</code></a></h2>
<pre><code>json &lt;value: any&gt; &lt;ident?: string | int&gt; -&gt; string
</code></pre>
<p>Serializes a given <code>value</code> into a JSON string. You can pass a string value used as ident or a number of spaces used as indent.</p>
<p><strong>Example:</strong></p>
<pre><code>{{ json .someObject 2 }}
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="scripting"><a class="header" href="#scripting">Scripting</a></h1>
<p>Scripting sections like <code>[Script]</code> and <code>[PreScript]</code> use a dedicated scripting micro-engine for maximum flexibility in your test setup and procedures.</p>
<p>Goat uses ES5.1 conform JavaScript interpreted by the <a href="https://github.com/dop251/goja">goja</a> micro-engine.</p>
<p>In each script instance, you have access to the current state values via the global environment variables. Also, you can define global variables using the <code>var</code> statement to define values which will be saved in the state after successful script execution.</p>
<p>Example:</p>
<blockquote>
<p>Initial State</p>
<pre><code class="language-toml">foo = 1
</code></pre>
</blockquote>
<blockquote>
<p>Script Execution</p>
<pre><code class="language-js">var bar = foo * 2;
</code></pre>
</blockquote>
<blockquote>
<p>Resulting State</p>
<pre><code class="language-toml">foo = 1
bar = 2
</code></pre>
</blockquote>
<p>Also, some <a href="scripting/./builtins.html">built-in functions</a> are available in each script instance.</p>
<div style="break-before: page; page-break-before: always;"></div><h1 id="builtins"><a class="header" href="#builtins">Builtins</a></h1>
<p>The following built-in functions are available in each script instance.</p>
<ul>
<li><a href="scripting/builtins.html#assert"><code>assert</code></a></li>
<li><a href="scripting/builtins.html#assert_eq"><code>assert_eq</code></a></li>
<li><a href="scripting/builtins.html#print"><code>print</code></a></li>
<li><a href="scripting/builtins.html#println"><code>println</code></a></li>
<li><a href="scripting/builtins.html#info"><code>info</code></a></li>
<li><a href="scripting/builtins.html#warn"><code>warn</code></a></li>
<li><a href="scripting/builtins.html#error"><code>error</code></a></li>
<li><a href="scripting/builtins.html#fatal"><code>fatal</code></a></li>
<li><a href="scripting/builtins.html#debug"><code>debug</code></a></li>
<li><a href="scripting/builtins.html#infof"><code>infof</code></a></li>
<li><a href="scripting/builtins.html#warnf"><code>warnf</code></a></li>
<li><a href="scripting/builtins.html#errorf"><code>errorf</code></a></li>
<li><a href="scripting/builtins.html#fatalf"><code>fatalf</code></a></li>
<li><a href="scripting/builtins.html#debugf"><code>debugf</code></a></li>
</ul>
<h2 id="assert"><a class="header" href="#assert"><code>assert</code></a></h2>
<pre><code class="language-ts">function assert(expression: bool, fail_message?: string): void;
</code></pre>
<p>Takes an <code>expression</code> which, when evaluated to <code>false</code>, will throw an assert exception. You can pass an additional <code>fail_message</code> which will be shown in the exception. This can be used to assert values in responses and fail test execution if they are invalid.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">assert(response.StatusCode &gt;= 400, `Status code was ${response.StatusCode}`);
</code></pre>
<h2 id="assert_eq"><a class="header" href="#assert_eq"><code>assert_eq</code></a></h2>
<pre><code class="language-ts">function assert_eq(value: any, expected: any, fail_message?: string): void;
</code></pre>
<p>Takes a <code>value</code> and an <code>expected</code> value and deep-equals them. That means, that also contents of objects and lists are compared. If the comparison fails, it will throw an exception which will also display both compared values. You can also pass an additional <code>fail_message</code> to further specify the error output.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">assert(response.StatusCode &gt;= 400, `Status code was ${response.StatusCode}`);
</code></pre>
<h2 id="print"><a class="header" href="#print"><code>print</code></a></h2>
<pre><code class="language-ts">function print(...message: string[]): void;
</code></pre>
<p>Prints the given <code>message</code> to the terminal without a leading new line.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">print("Hello world!");
</code></pre>
<h2 id="println"><a class="header" href="#println"><code>println</code></a></h2>
<pre><code class="language-ts">function println(...message: string[]): void;
</code></pre>
<p>Prints the given <code>message</code> to the terminal with a leading new line.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">println("Hello world!");
</code></pre>
<h2 id="info"><a class="header" href="#info"><code>info</code></a></h2>
<pre><code class="language-ts">function info(...message: string[]): void;
</code></pre>
<p>Logs an <em>info</em> log entry to the output logger(s) with the given <code>message</code>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">info("Hello world!");
</code></pre>
<h2 id="warn"><a class="header" href="#warn"><code>warn</code></a></h2>
<pre><code class="language-ts">function warn(...message: string[]): void;
</code></pre>
<p>Logs a <em>warn</em> log entry to the output logger(s) with the given <code>message</code>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">warn("Hello world!");
</code></pre>
<h2 id="error"><a class="header" href="#error"><code>error</code></a></h2>
<pre><code class="language-ts">function error(...message: string[]): void;
</code></pre>
<p>Logs an <em>error</em> log entry to the output logger(s) with the given <code>message</code>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">error("Hello world!");
</code></pre>
<h2 id="fatal"><a class="header" href="#fatal"><code>fatal</code></a></h2>
<pre><code class="language-ts">function fatal(...message: string[]): void;
</code></pre>
<p>Logs a <em>fatal</em> log entry to the output logger(s) with the given <code>message</code>. This will also abort the batch execution.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">fatal("Hello world!");
</code></pre>
<h2 id="debug"><a class="header" href="#debug"><code>debug</code></a></h2>
<pre><code class="language-ts">function debug(...message: string[]): void;
</code></pre>
<p>Logs a <em>debug</em> log entry to the output logger(s) with the given <code>message</code>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">debug("Hello world!");
</code></pre>
<h2 id="infof"><a class="header" href="#infof"><code>infof</code></a></h2>
<pre><code class="language-ts">function infof(format: string, ...values: any[]): void;
</code></pre>
<p>Logs an <em>info</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">infof("Hello %s!", "World");
</code></pre>
<h2 id="warnf"><a class="header" href="#warnf"><code>warnf</code></a></h2>
<pre><code class="language-ts">function warnf(format: string, ...values: any[]): void;
</code></pre>
<p>Logs a <em>warn</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">warnf("Hello %s!", "World");
</code></pre>
<h2 id="errorf"><a class="header" href="#errorf"><code>errorf</code></a></h2>
<pre><code class="language-ts">function errorf(format: string, ...values: any[]): void;
</code></pre>
<p>Logs an <em>error</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">errorf("Hello %s!", "World");
</code></pre>
<h2 id="fatalf"><a class="header" href="#fatalf"><code>fatalf</code></a></h2>
<pre><code class="language-ts">function fatalf(format: string, ...values: any[]): void;
</code></pre>
<p>Logs a <em>fatal</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>. This will also abort the batch execution.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">fatalf("Hello %s!", "World");
</code></pre>
<h2 id="debugf"><a class="header" href="#debugf"><code>debugf</code></a></h2>
<pre><code class="language-ts">function debugf(format: string, ...values: any[]): void;
</code></pre>
<p>Logs a <em>debug</em> log entry to the output logger(s) with the given <code>format</code> formatted with the given <code>values</code>. Formatting is handled according to <a href="https://pkg.go.dev/fmt">Go's formatting implementation</a>.</p>
<p><strong>Example</strong></p>
<pre><code class="language-js">debugf("Hello %s!", "World");
</code></pre>
<div style="break-before: page; page-break-before: always;"></div><h1 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h1>
<p>When you write extensive integration tests for your products, you can use different strategies to re-use often utilized snippets. In this document, you will find some inspiration for how large sets of Goatfiles can be structured.</p>
<h2 id="centralizing-commonly-used-snippets"><a class="header" href="#centralizing-commonly-used-snippets">Centralizing commonly used snippets</a></h2>
<p>As you might know, you can extract often used snippets into their own Goatfiles which can then be re-used in other files either via the <a href="project-structure/../goatfile/import-statement.html"><code>use</code></a> or the <a href="project-structure/../goatfile/execute-statement.html"><code>execute</code></a> statement.</p>
<p>If you have multiple projects which share a similar backend logic, the best approach is to collect shared routines in a separate dependency. For example, you could create a separate Git repository with some utility Goatfiles, which is then added as a Git sub-module to your main projects. Make sure to prefix the name of the target directory in your projects with an underscore (<code>_</code>), so that the Goat CLI will not try to execute them by accident.</p>
<p>Example use-cases for that could be</p>
<ul>
<li>logging in with one or more user accounts</li>
<li>setting default headers for all requests</li>
<li>encapsulating common procedures like creating and cleaning up entities</li>
</ul>
<h2 id="file-structure"><a class="header" href="#file-structure">File Structure</a></h2>
<p>In our projects, we employ the following file structure for API integration tests in all our projects. Maybe you can use this for inspiration for your own structure.</p>
<pre><code>integrationtests/
├── _shed/
├── issues/
│   └── 123/
│       └── main.goat
├── tests/
│   └── users/
│       ├── _util.goat
│       ├── create.goat
│       ├── list.goat
│       └── delete.goat
├── params.toml.template
├── local.toml
├── staging.toml
└── ci.toml
</code></pre>
<p>As you can see, we have a directory called <code>integrationtests/</code> in all of our projects which contains all tests, test utilities, as well as parameter files.</p>
<p><code>_shed/</code> is the name of our dependency containing some utility Goatfiles used, e.g., to create new users, log in as users with different permissions, set request defaults, and much more. As you can see, this directory is prefixed with <code>_</code>, so it will not be executed when calling Goat on the <code>integrationtests/</code> directory.</p>
<p><code>issues/</code> contains sub-directories with the names of tickets on our issue board. These are there to demonstrate misbehaviour cases of our API, so these tests should fail on the latest dev state. These can also be used to test against fixes of these issues. When the issue is resolved, these tests should be moved into the respective <code>tests/</code> sub-directory.</p>
<p><code>tests/</code> contains the actual integration tests grouped by features. These tests should always pass against the latest dev state, otherwise something might be broken.</p>
<p>We use some user-specific parameters passed into the tests which are stored in different <code>*.toml</code> files in the <code>integrationtests/</code> directory. These should be specified in the project's <code>.gitignore</code>, because every developer might have their own parameters like API keys or user credentials. You could also put a parameter file for automatic tests in there (like <code>ci.toml</code> in our example) which is commited into the repository. The <code>params.toml.template</code> is a template file to base custom parameter files on. This is handy because the integration tests expect specific parameters to work with. An example <code>params.toml.template</code> could look as follows:</p>
<pre><code class="language-toml"># The server instance to connect to.
instance = "http://localhost:10001"

# Credentials for a user with non-admin privileges.
[credentials.low]
username = "test@test"
password = "password"
apikey = "some api key"

# Credentiasl for a user with admin privileges.
[credentials.admin]
username = "root@root"
password = "password"
apikey = "some api key"
</code></pre>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>To simplify the usage of our Goatfiles, we employ a system of documentation to record what a Goatfile does, which parameters it expects and – if it is a Goatfile meant to be executed or used in other Goatfiles – which state variables it creates that can be further used or captured in an <code>execute</code>'s return statement.</p>
<p>The documentation is prefixed with three forward slashes and sits at the very top of the Goatfile. First, the purpose of the file is stated, followed by required parameters. After that, you can specify the variables created in the execution in the same manner.</p>
<p>Let's take the following as an example for a Goatfile which can be imported in your test via a <code>use</code> directive. Its purpose is to log in two users with two different privilege groups.</p>
<pre><code>/// Logs in with a `low` and an `admin` user to the system and stores
/// the session in the `default` cookiejar for the `low` user and
/// in the `admin` cookiejar for the `admin` user.
/// 
/// 
/// Required Parameters
/// -----------------------------------------------------------------------
/// instance:                       The root address of the API instance.
/// credentials.low.username:       Username of the `low` user
/// credentials.low.password:       Password of the `low` user
/// credentials.admin.username:     Username of the `admin` user
/// credentials.admin.password:     Password of the `admin` user
/// 
/// 

### Setup

POST {{.instance}}/api/auth/login

[Header]
Content-Type: application/json

[Body]
{
  "username": "{{.credentials.low.username}}",
  "password": "{{.credentials.low.password}}"
}

[Script]
assert(response.StatusCode == 200, `Status code was ${response.StatusCode}`);

---

POST {{.instance}}/api/auth/login

[Options]
cookiejar = "admin"

[Header]
Content-Type: application/json


[Body]
{
  "username": "{{.credentials.admin.username}}",
  "password": "{{.credentials.admin.password}}"
}

[Script]
assert(response.StatusCode == 200, `Status code was ${response.StatusCode}`);

---
</code></pre>
<p>After this Goatfile is executed with <code>use</code>, the cookie jars for the two users persist and can be used with further requests in the executing Goatfile.</p>
<p>In contrast, this second example shows a Goatfile which is created to be used with an <code>execute</code> statement in another Goatfile:</p>
<pre><code>/// Creates a new user.
/// 
/// 
/// Parameters
/// -----------------------------------------------------------------------
/// instance:   The root address of the API instance.
/// username:   User name of the new user.
/// password:   Password of the new user.
/// 
///
/// Returns
/// -----------------------------------------------------------------------
/// userid:     The ID of the new user.


// ...
</code></pre>
<p>The ID of the created user is returned so that the executing Goatfile can use it further but no other state information is retained.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="elasticlunr.min.js"></script>
        <script src="mark.min.js"></script>
        <script src="searcher.js"></script>

        <script src="clipboard.min.js"></script>
        <script src="highlight.js"></script>
        <script src="book.js"></script>

        <!-- Custom JS scripts -->
        <script src="js/mermaid.min.js"></script>
        <script src="js/mermaid-init.js"></script>

        <script>
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>

    </div>
    </body>
</html>
