<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Lifecycle - Goat</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../toc.js"></script>
    </head>
    <body>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Goat</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="lifecycle"><a class="header" href="#lifecycle">Lifecycle</a></h1>
<p>In this section, you will learn the basics on how exactly batches and requests are executed and when which section of a batch or test is evaluated.</p>
<h2 id="sections"><a class="header" href="#sections">Sections</a></h2>
<p>First of all, a batch consists of four logical sections.</p>
<ul>
<li>
<p><strong><code>Default</code></strong>: Contains default request parameters which are passed on to each executed request in the batch. This is the only section which does not actually execute actions and supports partial request fields.</p>
</li>
<li>
<p><strong><code>Setup</code></strong>: Contains actions which should be executed before the actual test steps are ran.</p>
</li>
<li>
<p><strong><code>Tests</code></strong>: The actual test actions.</p>
</li>
<li>
<p><strong><code>Teardown</code></strong>: Steps that are run after the test executions, e.g., to clean up stuff from the <code>Setup</code> and <code>Test</code> sections.</p>
</li>
</ul>
<h2 id="batch-lifecycle"><a class="header" href="#batch-lifecycle">Batch Lifecycle</a></h2>
<p>Below, you can find a simplified schematic of how a single test batch is executed.</p>
<pre class="mermaid">%%{init: {'theme':'dark'}}%%
flowchart TD
  collect_args[Collect params\nand arguments]
  entry[Parse entry Goatfile]
  resolve_imports[Resolve imports]
  parse_imports[Parse imports]
  merge_files[Merge files]
  create_state[Create state]
  setup_actions[Execute setup actions]
  setup_failed{Failed?}
  teardown_actions[Execute Teardown actions]
  test_actions[Execute Test actions]
  test_failed{Failed?}

  entry
    --&gt; resolve_imports
    --&gt; parse_imports -.-&gt; entry
  
  parse_imports
    --&gt; merge_files
    --&gt; setup_actions

  collect_args 
    ----&gt; create_state
    --&gt; setup_actions
    --&gt; setup_failed -- yes --&gt; teardown_actions
        setup_failed -- no --&gt; test_actions
          --&gt; test_failed -- yes --&gt; teardown_actions
              test_failed -- no --&gt; teardown_actions
</pre>
<p>Every batch begins with a single entrypoint Goatfile <em>(if you execute Goat on a folder of Goatfiles, each Goatfile in that folder will be seen as an entrypoint Goatfile and the batch execution will be executed indiviually for each file)</em>.</p>
<p>First, all imported <em>(see <a href="../goatfile/import-statement.html"><code>use</code></a>)</em> Goatfiles are resolved, parsed and merged together with the entrypoint Goatfile to one single batch execution. So all <code>Default</code>, <code>Setup</code>, <code>Test</code> and <code>Teardown</code> entries are merged together for each file.</p>
<p>"Simultaneously", all parameters are collected from passed parameter files, environment variables and arguments <em>(see <a href="../command-line-tool/index.html#flags">Command Line Tool</a>)</em>. These form the initial state.</p>
<p>After that, all <code>Setup</code> actions are executed. If any setup action has failed, the rest of the setup and the entire <code>Test</code> section is skipped. Finally, all teardown steps are executed and the batch exits in a failed state summarizing all errors that occurred.</p>
<p>If the <code>Setup</code> has completed successfully, the <code>Test</code> section is executed. Just as in the <code>Setup</code> section, if any of the <code>Test</code> actions fails, the entire section is skipped, the teardown actions are executed and the batch exits in a failed state.</p>
<p>If the <code>Test</code> section has completed successfully, the <code>Teardown</code> section is executed. Here, if any action fails, the execution <strong>continues</strong> instead of skipping the rest of the actions to ensure a complete cleanup as intended. If any of the <code>Teardown</code> actions fail, the batch execution will result in a failed state as well.</p>
<h2 id="action-lifecycle"><a class="header" href="#action-lifecycle">Action Lifecycle</a></h2>
<p>Below, you can see a simplified lifecycle diagram of the three actions <code>Request</code>, <code>Execute</code> and <code>Log Section</code>.</p>
<pre class="mermaid">%%{init: {'theme':'dark'}}%%
flowchart TD
  type{Type of Action}

  exit_with_failure(End with Failure)
  exit_with_success(End with Success)

  %% --- Request Type -----------------------------------------------

  apply_defaults[Apply defaults]
  pre_substitute[Substitute parameters\nfrom state]
  run_prescript[Run PreScript]
  prescript_success{Successful?}
  substitute[Re-substitute parameters\nfrom state]
  apply_options[Apply request options]
  condition_option{Condition option\nmatches?}
  run_request[Run Request]
  run_script[Run Script]
  script_success{Successful?}

  type 
    -- Request --&gt; apply_defaults
    --&gt; pre_substitute
    --&gt; run_prescript
    --&gt; prescript_success -- no --&gt; exit_with_failure
  
  prescript_success 
    -- yes --&gt; substitute
    --&gt; apply_options
  
  condition_option
    -- yes --&gt; run_request
    --&gt; run_script
    --&gt; script_success -- no --&gt; exit_with_failure

  script_success -- yes --&gt; exit_with_success

  apply_options --&gt; condition_option -- no --&gt; exit_with_success

  %% --- Execute Type -----------------------------------------------

  create_state_from_params[Create state from\npassed parameters]
  parse_goatfile[Parse Goatfile]
  execute_goatfile[Execute Goatfile]
  execute_success{Successful?}
  apply_captured[Apply captured\nreturn Values]

  type
    -- Execute --&gt; create_state_from_params
    --&gt; parse_goatfile
    --&gt; execute_goatfile
    --&gt; execute_success -- no --&gt; exit_with_failure

  execute_success
    -- yes --&gt; apply_captured
    -------&gt; exit_with_success
    
  %% --- Log Section Type -----------------------------------------------

  print_logsection[Print Section to Log]

  type
    -- Log Section --&gt; print_logsection 
    -----------&gt; exit_with_success
</pre>
<h3 id="request"><a class="header" href="#request">Request</a></h3>
<p>A <code>Request</code> action begins with the application of all default parameters from the <code>Default</code> section of the batch. After that, the parameters from the current state are substituted for the template parameters in the request definition. With the resulting state, the <code>PreScript</code> section is executed. If the execution failed, the request ends with a failure state. Otherwise, the new state is extracted and all templates are re-substituted using the new state. Following this, the request options are evaluated and applied. If the option <code>condition</code> evaluates to <code>false</code>, the request is skipped which ends the request in a success state. Otherwise, the actual request is now executed. Finally, the <code>Script</code> section is executed using the current state. Depending on the result, the request will end with a failure or success state.</p>
<h3 id="execute"><a class="header" href="#execute">Execute</a></h3>
<p>An <code>Execute</code> action "calls" another Goatfile with specified parameters and capture values. The defined parameters are used to initialize a new state. After that, the referenced Goatfile is parsed and executed with this new state. This execution is a whole new <a href="#batch-lifecycle">Batch</a> execution in itself.</p>
<p>If this batch execution fails, the action results in a failed state as well. If it is successful, the defined values to be captured in the <code>return</code> statement are merged with the current state of the executing batch.</p>
<h3 id="log-section"><a class="header" href="#log-section">Log Section</a></h3>
<p>A <code>Log Section</code> is simply an action that prints a visual separator as <code>INFO</code> entry into the log to visually separate between test sections. This should never result in a failed action state.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../explanations/state.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../goatfile/index.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../explanations/state.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../goatfile/index.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../js/mermaid.min.js"></script>
        <script src="../js/mermaid-init.js"></script>


    </div>
    </body>
</html>
