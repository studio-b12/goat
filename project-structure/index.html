<!DOCTYPE HTML>
<html lang="en" class="light" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Project Structure - Goat</title>


        <!-- Custom HTML head -->
        
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../favicon.svg">
        <link rel="shortcut icon" href="../favicon.png">
        <link rel="stylesheet" href="../css/variables.css">
        <link rel="stylesheet" href="../css/general.css">
        <link rel="stylesheet" href="../css/chrome.css">
        <link rel="stylesheet" href="../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="../highlight.css">
        <link rel="stylesheet" href="../tomorrow-night.css">
        <link rel="stylesheet" href="../ayu-highlight.css">

        <!-- Custom theme stylesheets -->

    </head>
    <body class="sidebar-visible no-js">
    <div id="body-container">
        <!-- Provide site root to javascript -->
        <script>
            var path_to_root = "../";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('light')
            html.classList.add(theme);
            var body = document.querySelector('body');
            body.classList.remove('no-js')
            body.classList.add('js');
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            var body = document.querySelector('body');
            var sidebar = null;
            var sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
            }
            sidebar_toggle.checked = sidebar === 'visible';
            body.classList.remove('sidebar-visible');
            body.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="../introduction/index.html"><strong aria-hidden="true">1.</strong> Introduction</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../introduction/glossary.html"><strong aria-hidden="true">1.1.</strong> Glossary</a></li></ol></li><li class="chapter-item expanded "><a href="../getting-started/index.html"><strong aria-hidden="true">2.</strong> Getting Started</a></li><li class="chapter-item expanded "><a href="../command-line-tool/index.html"><strong aria-hidden="true">3.</strong> Command Line Tool</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../command-line-tool/profiles.html"><strong aria-hidden="true">3.1.</strong> Profiles</a></li></ol></li><li class="chapter-item expanded "><a href="../explanations/index.html"><strong aria-hidden="true">4.</strong> How does it work?</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../explanations/state.html"><strong aria-hidden="true">4.1.</strong> State Management</a></li><li class="chapter-item expanded "><a href="../explanations/lifecycle.html"><strong aria-hidden="true">4.2.</strong> Lifecycle</a></li></ol></li><li class="chapter-item expanded "><a href="../goatfile/index.html"><strong aria-hidden="true">5.</strong> Goatfile</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../goatfile/comments.html"><strong aria-hidden="true">5.1.</strong> Comment</a></li><li class="chapter-item expanded "><a href="../goatfile/import-statement.html"><strong aria-hidden="true">5.2.</strong> Import Statement</a></li><li class="chapter-item expanded "><a href="../goatfile/execute-statement.html"><strong aria-hidden="true">5.3.</strong> Execute Statement</a></li><li class="chapter-item expanded "><a href="../goatfile/sections.html"><strong aria-hidden="true">5.4.</strong> Section</a></li><li class="chapter-item expanded "><a href="../goatfile/defaults-section.html"><strong aria-hidden="true">5.5.</strong> Defaults Section</a></li><li class="chapter-item expanded "><a href="../goatfile/logsections.html"><strong aria-hidden="true">5.6.</strong> Log Section</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/index.html"><strong aria-hidden="true">5.7.</strong> Request</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../goatfile/requests/method-and-url.html"><strong aria-hidden="true">5.7.1.</strong> Method and URL</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/options.html"><strong aria-hidden="true">5.7.2.</strong> Options</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/header.html"><strong aria-hidden="true">5.7.3.</strong> Headers</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/query-params.html"><strong aria-hidden="true">5.7.4.</strong> Query Parameters</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/auth.html"><strong aria-hidden="true">5.7.5.</strong> Auth</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/body.html"><strong aria-hidden="true">5.7.6.</strong> Body</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/formdata.html"><strong aria-hidden="true">5.7.7.</strong> FormData</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/prescript.html"><strong aria-hidden="true">5.7.8.</strong> PreScript</a></li><li class="chapter-item expanded "><a href="../goatfile/requests/script.html"><strong aria-hidden="true">5.7.9.</strong> Script</a></li></ol></li></ol></li><li class="chapter-item expanded "><a href="../templating/index.html"><strong aria-hidden="true">6.</strong> Templating</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../templating/builtins.html"><strong aria-hidden="true">6.1.</strong> Built-ins</a></li></ol></li><li class="chapter-item expanded "><a href="../scripting/index.html"><strong aria-hidden="true">7.</strong> Scripting</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="../scripting/builtins.html"><strong aria-hidden="true">7.1.</strong> Built-ins</a></li></ol></li><li class="chapter-item expanded "><a href="../project-structure/index.html" class="active"><strong aria-hidden="true">8.</strong> Project Structure</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <!-- Track and set sidebar scroll position -->
        <script>
            var sidebarScrollbox = document.querySelector('#sidebar .sidebar-scrollbox');
            sidebarScrollbox.addEventListener('click', function(e) {
                if (e.target.tagName === 'A') {
                    sessionStorage.setItem('sidebar-scroll', sidebarScrollbox.scrollTop);
                }
            }, { passive: true });
            var sidebarScrollTop = sessionStorage.getItem('sidebar-scroll');
            sessionStorage.removeItem('sidebar-scroll');
            if (sidebarScrollTop) {
                // preserve sidebar scroll position when navigating via links within sidebar
                sidebarScrollbox.scrollTop = sidebarScrollTop;
            } else {
                // scroll sidebar to current active section when navigating via "next/previous chapter" buttons
                var activeSection = document.querySelector('#sidebar .active');
                if (activeSection) {
                    activeSection.scrollIntoView({ block: 'center' });
                }
            }
        </script>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Goat</h1>

                    <div class="right-buttons">
                        <a href="../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="project-structure"><a class="header" href="#project-structure">Project Structure</a></h1>
<p>When you write extensive integration tests for your products, you can use different strategies to re-use often utilized snippets. In this document, you will find some inspiration for how large sets of Goatfiles can be structured.</p>
<h2 id="centralizing-commonly-used-snippets"><a class="header" href="#centralizing-commonly-used-snippets">Centralizing commonly used snippets</a></h2>
<p>As you might know, you can extract often used snippets into their own Goatfiles which can then be re-used in other files either via the <a href="../goatfile/import-statement.html"><code>use</code></a> or the <a href="../goatfile/execute-statement.html"><code>execute</code></a> statement.</p>
<p>If you have multiple projects which share a similar backend logic, the best approach is to collect shared routines in a separate dependency. For example, you could create a separate Git repository with some utility Goatfiles, which is then added as a Git sub-module to your main projects. Make sure to prefix the name of the target directory in your projects with an underscore (<code>_</code>), so that the Goat CLI will not try to execute them by accident.</p>
<p>Example use-cases for that could be</p>
<ul>
<li>logging in with one or more user accounts</li>
<li>setting default headers for all requests</li>
<li>encapsulating common procedures like creating and cleaning up entities</li>
</ul>
<h2 id="file-structure"><a class="header" href="#file-structure">File Structure</a></h2>
<p>In our projects, we employ the following file structure for API integration tests in all our projects. Maybe you can use this for inspiration for your own structure.</p>
<pre><code>integrationtests/
├── _shed/
├── issues/
│   └── 123/
│       └── main.goat
├── tests/
│   └── users/
│       ├── _util.goat
│       ├── create.goat
│       ├── list.goat
│       └── delete.goat
├── params.toml.template
├── local.toml
├── staging.toml
└── ci.toml
</code></pre>
<p>As you can see, we have a directory called <code>integrationtests/</code> in all of our projects which contains all tests, test utilities, as well as parameter files.</p>
<p><code>_shed/</code> is the name of our dependency containing some utility Goatfiles used, e.g., to create new users, log in as users with different permissions, set request defaults, and much more. As you can see, this directory is prefixed with <code>_</code>, so it will not be executed when calling Goat on the <code>integrationtests/</code> directory.</p>
<p><code>issues/</code> contains sub-directories with the names of tickets on our issue board. These are there to demonstrate misbehaviour cases of our API, so these tests should fail on the latest dev state. These can also be used to test against fixes of these issues. When the issue is resolved, these tests should be moved into the respective <code>tests/</code> sub-directory.</p>
<p><code>tests/</code> contains the actual integration tests grouped by features. These tests should always pass against the latest dev state, otherwise something might be broken.</p>
<p>We use some user-specific parameters passed into the tests which are stored in different <code>*.toml</code> files in the <code>integrationtests/</code> directory. These should be specified in the project's <code>.gitignore</code>, because every developer might have their own parameters like API keys or user credentials. You could also put a parameter file for automatic tests in there (like <code>ci.toml</code> in our example) which is commited into the repository. The <code>params.toml.template</code> is a template file to base custom parameter files on. This is handy because the integration tests expect specific parameters to work with. An example <code>params.toml.template</code> could look as follows:</p>
<pre><code class="language-toml"># The server instance to connect to.
instance = "http://localhost:10001"

# Credentials for a user with non-admin privileges.
[credentials.low]
username = "test@test"
password = "password"
apikey = "some api key"

# Credentiasl for a user with admin privileges.
[credentials.admin]
username = "root@root"
password = "password"
apikey = "some api key"
</code></pre>
<h2 id="documentation"><a class="header" href="#documentation">Documentation</a></h2>
<p>To simplify the usage of our Goatfiles, we employ a system of documentation to record what a Goatfile does, which parameters it expects and – if it is a Goatfile meant to be executed or used in other Goatfiles – which state variables it creates that can be further used or captured in an <code>execute</code>'s return statement.</p>
<p>The documentation is prefixed with three forward slashes and sits at the very top of the Goatfile. First, the purpose of the file is stated, followed by required parameters. After that, you can specify the variables created in the execution in the same manner.</p>
<p>Let's take the following as an example for a Goatfile which can be imported in your test via a <code>use</code> directive. Its purpose is to log in two users with two different privilege groups.</p>
<pre><code>/// Logs in with a `low` and an `admin` user to the system and stores
/// the session in the `default` cookiejar for the `low` user and
/// in the `admin` cookiejar for the `admin` user.
/// 
/// 
/// Required Parameters
/// -----------------------------------------------------------------------
/// instance:                       The root address of the API instance.
/// credentials.low.username:       Username of the `low` user
/// credentials.low.password:       Password of the `low` user
/// credentials.admin.username:     Username of the `admin` user
/// credentials.admin.password:     Password of the `admin` user
/// 
/// 

### Setup

POST {{.instance}}/api/auth/login

[Header]
Content-Type: application/json

[Body]
{
  "username": "{{.credentials.low.username}}",
  "password": "{{.credentials.low.password}}"
}

[Script]
assert(response.StatusCode == 200, `Status code was ${response.StatusCode}`);

---

POST {{.instance}}/api/auth/login

[Options]
cookiejar = "admin"

[Header]
Content-Type: application/json


[Body]
{
  "username": "{{.credentials.admin.username}}",
  "password": "{{.credentials.admin.password}}"
}

[Script]
assert(response.StatusCode == 200, `Status code was ${response.StatusCode}`);

---
</code></pre>
<p>After this Goatfile is executed with <code>use</code>, the cookie jars for the two users persist and can be used with further requests in the executing Goatfile.</p>
<p>In contrast, this second example shows a Goatfile which is created to be used with an <code>execute</code> statement in another Goatfile:</p>
<pre><code>/// Creates a new user.
/// 
/// 
/// Parameters
/// -----------------------------------------------------------------------
/// instance:   The root address of the API instance.
/// username:   User name of the new user.
/// password:   Password of the new user.
/// 
///
/// Returns
/// -----------------------------------------------------------------------
/// userid:     The ID of the new user.


// ...
</code></pre>
<p>The ID of the created user is returned so that the executing Goatfile can use it further but no other state information is retained.</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../scripting/builtins.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>


                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../scripting/builtins.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../elasticlunr.min.js"></script>
        <script src="../mark.min.js"></script>
        <script src="../searcher.js"></script>

        <script src="../clipboard.min.js"></script>
        <script src="../highlight.js"></script>
        <script src="../book.js"></script>

        <!-- Custom JS scripts -->
        <script src="../js/mermaid.min.js"></script>
        <script src="../js/mermaid-init.js"></script>


    </div>
    </body>
</html>
